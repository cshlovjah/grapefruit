/**
 * @license
 * GrapeFruit Game Engine - v0.0.2
 * Copyright (c) 2012, Chad Engler
 * https://github.com/englercj/grapefruit
 *
 * Compiled: 2013-04-18
 *
 * GrapeFruit Game Engine is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license.php
 */
(function(window,undefined){function HEXtoRGB(hex){return[(255&hex>>16)/255,(255&hex>>8)/255,(255&hex)/255]}function determineMatrixArrayType(){return PIXI.Matrix="undefined"!=typeof Float32Array?Float32Array:Array,PIXI.Matrix}document=window.document,function(o){"function"==typeof define?define(o):"function"==typeof YUI?YUI.add("es5",o):o()}(function(){function o(){}function v(a){return a=+a,a!==a?a=0:0!==a&&a!==1/0&&a!==-(1/0)&&(a=(a>0||-1)*Math.floor(Math.abs(a))),a}function s(a){var b=typeof a;return null===a||"undefined"===b||"boolean"===b||"number"===b||"string"===b}Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError("Function.prototype.bind called on incompatible "+b);var d=q.call(arguments,1),c=function(){if(this instanceof c){var e=b.apply(this,d.concat(q.call(arguments)));return Object(e)===e?e:this}return b.apply(a,d.concat(q.call(arguments)))};return b.prototype&&(o.prototype=b.prototype,c.prototype=new o,o.prototype=null),c});var k=Function.prototype.call,p=Object.prototype,q=Array.prototype.slice,h=k.bind(p.toString),t=k.bind(p.hasOwnProperty);if(t(p,"__defineGetter__")&&(k.bind(p.__defineGetter__),k.bind(p.__defineSetter__),k.bind(p.__lookupGetter__),k.bind(p.__lookupSetter__)),2!=[1,2].splice(0).length){var y=Array.prototype.splice;Array.prototype.splice=function(a,b){return arguments.length?y.apply(this,[a===void 0?0:a,b===void 0?this.length-a:b].concat(q.call(arguments,2))):[]}}if(1!=[].unshift(0)){var z=Array.prototype.unshift;Array.prototype.unshift=function(){return z.apply(this,arguments),this.length}}Array.isArray||(Array.isArray=function(a){return"[object Array]"==h(a)});var k=Object("a"),l="a"!=k[0]||!(0 in k);if(Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var d=n(this),c=l&&"[object String]"==h(this)?this.split(""):d,e=-1,f=c.length>>>0;if("[object Function]"!=h(a))throw new TypeError;for(;f>++e;)e in c&&a.call(b,c[e],e,d)}),Array.prototype.map||(Array.prototype.map=function(a,b){var d=n(this),c=l&&"[object String]"==h(this)?this.split(""):d,e=c.length>>>0,f=Array(e);if("[object Function]"!=h(a))throw new TypeError(a+" is not a function");for(var g=0;e>g;g++)g in c&&(f[g]=a.call(b,c[g],g,d));return f}),Array.prototype.filter||(Array.prototype.filter=function(a,b){var g,d=n(this),c=l&&"[object String]"==h(this)?this.split(""):d,e=c.length>>>0,f=[];if("[object Function]"!=h(a))throw new TypeError(a+" is not a function");for(var i=0;e>i;i++)i in c&&(g=c[i],a.call(b,g,i,d)&&f.push(g));return f}),Array.prototype.every||(Array.prototype.every=function(a,b){var d=n(this),c=l&&"[object String]"==h(this)?this.split(""):d,e=c.length>>>0;if("[object Function]"!=h(a))throw new TypeError(a+" is not a function");for(var f=0;e>f;f++)if(f in c&&!a.call(b,c[f],f,d))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(a,b){var d=n(this),c=l&&"[object String]"==h(this)?this.split(""):d,e=c.length>>>0;if("[object Function]"!=h(a))throw new TypeError(a+" is not a function");for(var f=0;e>f;f++)if(f in c&&a.call(b,c[f],f,d))return!0;return!1}),Array.prototype.reduce||(Array.prototype.reduce=function(a){var b=n(this),d=l&&"[object String]"==h(this)?this.split(""):b,c=d.length>>>0;if("[object Function]"!=h(a))throw new TypeError(a+" is not a function");if(!c&&1==arguments.length)throw new TypeError("reduce of empty array with no initial value");var f,e=0;if(arguments.length>=2)f=arguments[1];else for(;;){if(e in d){f=d[e++];break}if(++e>=c)throw new TypeError("reduce of empty array with no initial value")}for(;c>e;e++)e in d&&(f=a.call(void 0,f,d[e],e,b));return f}),Array.prototype.reduceRight||(Array.prototype.reduceRight=function(a){var b=n(this),d=l&&"[object String]"==h(this)?this.split(""):b,c=d.length>>>0;if("[object Function]"!=h(a))throw new TypeError(a+" is not a function");if(!c&&1==arguments.length)throw new TypeError("reduceRight of empty array with no initial value");var e,c=c-1;if(arguments.length>=2)e=arguments[1];else for(;;){if(c in d){e=d[c--];break}if(0>--c)throw new TypeError("reduceRight of empty array with no initial value")}do c in this&&(e=a.call(void 0,e,d[c],c,b));while(c--);return e}),Array.prototype.indexOf&&-1==[0,1].indexOf(1,2)||(Array.prototype.indexOf=function(a){var b=l&&"[object String]"==h(this)?this.split(""):n(this),d=b.length>>>0;if(!d)return-1;var c=0;for(arguments.length>1&&(c=v(arguments[1])),c=c>=0?c:Math.max(0,d+c);d>c;c++)if(c in b&&b[c]===a)return c;return-1}),Array.prototype.lastIndexOf&&-1==[0,1].lastIndexOf(0,-3)||(Array.prototype.lastIndexOf=function(a){var b=l&&"[object String]"==h(this)?this.split(""):n(this),d=b.length>>>0;if(!d)return-1;var c=d-1;for(arguments.length>1&&(c=Math.min(c,v(arguments[1]))),c=c>=0?c:d-Math.abs(c);c>=0;c--)if(c in b&&a===b[c])return c;return-1}),!Object.keys){var r,w=!0,x="toString toLocaleString valueOf hasOwnProperty isPrototypeOf propertyIsEnumerable constructor".split(" "),A=x.length;for(r in{toString:null})w=!1;Object.keys=function(a){if("object"!=typeof a&&"function"!=typeof a||null===a)throw new TypeError("Object.keys called on a non-object");var d,b=[];for(d in a)t(a,d)&&b.push(d);if(w)for(d=0;A>d;d++){var c=x[d];t(a,c)&&b.push(c)}return b}}Date.prototype.toISOString&&-1!==new Date(-621987552e5).toISOString().indexOf("-000001")||(Date.prototype.toISOString=function(){var a,b,d,c;if(!isFinite(this))throw new RangeError("Date.prototype.toISOString called on non-finite value.");for(c=this.getUTCFullYear(),a=this.getUTCMonth(),c+=Math.floor(a/12),a=[(a%12+12)%12+1,this.getUTCDate(),this.getUTCHours(),this.getUTCMinutes(),this.getUTCSeconds()],c=(0>c?"-":c>9999?"+":"")+("00000"+Math.abs(c)).slice(c>=0&&9999>=c?-4:-6),b=a.length;b--;)d=a[b],10>d&&(a[b]="0"+d);return c+"-"+a.slice(0,2).join("-")+"T"+a.slice(2).join(":")+"."+("000"+this.getUTCMilliseconds()).slice(-3)+"Z"}),r=!1;try{r=Date.prototype.toJSON&&null===new Date(0/0).toJSON()&&-1!==new Date(-621987552e5).toJSON().indexOf("-000001")&&Date.prototype.toJSON.call({toISOString:function(){return!0}})}catch(H){}r||(Date.prototype.toJSON=function(){var b,a=Object(this);a:{if(!s(a)){if(b=a.valueOf,"function"==typeof b&&(b=b.call(a),s(b)))break a;if(b=a.toString,"function"==typeof b&&(b=b.call(a),s(b)))break a;throw new TypeError}b=a}if("number"==typeof b&&!isFinite(b))return null;if(b=a.toISOString,"function"!=typeof b)throw new TypeError("toISOString property is not callable");return b.call(a)});var j,g=Date,m=function(a,b,d,c,e,f,h){var i=arguments.length;return this instanceof g?(i=1==i&&a+""===a?new g(m.parse(a)):i>=7?new g(a,b,d,c,e,f,h):i>=6?new g(a,b,d,c,e,f):i>=5?new g(a,b,d,c,e):i>=4?new g(a,b,d,c):i>=3?new g(a,b,d):i>=2?new g(a,b):i>=1?new g(a):new g,i.constructor=m,i):g.apply(this,arguments)},u=function(a,b){var d=b>1?1:0;return B[b]+Math.floor((a-1969+d)/4)-Math.floor((a-1901+d)/100)+Math.floor((a-1601+d)/400)+365*(a-1970)},C=RegExp("^(\\d{4}|[+-]\\d{6})(?:-(\\d{2})(?:-(\\d{2})(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:\\.(\\d{3}))?)?(Z|(?:([-+])(\\d{2}):(\\d{2})))?)?)?)?$"),B=[0,31,59,90,120,151,181,212,243,273,304,334,365];for(j in g)m[j]=g[j];if(m.now=g.now,m.UTC=g.UTC,m.prototype=g.prototype,m.prototype.constructor=m,m.parse=function(a){var b=C.exec(a);if(b){var d=Number(b[1]),c=Number(b[2]||1)-1,e=Number(b[3]||1)-1,f=Number(b[4]||0),h=Number(b[5]||0),i=Number(b[6]||0),j=Number(b[7]||0),m=!b[4]||b[8]?0:Number(new g(1970,0)),k="-"===b[9]?1:-1,l=Number(b[10]||0),b=Number(b[11]||0);return(h>0||i>0||j>0?24:25)>f&&60>h&&60>i&&1e3>j&&c>-1&&12>c&&24>l&&60>b&&e>-1&&u(d,c+1)-u(d,c)>e&&(d=60*(24*(u(d,c)+e)+f+l*k),d=1e3*(60*(d+h+b*k)+i)+j+m,d>=-864e13&&864e13>=d)?d:0/0}return g.parse.apply(this,arguments)},Date=m,Date.now||(Date.now=function(){return(new Date).getTime()}),"0".split(void 0,0).length){var D=String.prototype.split;String.prototype.split=function(a,b){return a===void 0&&0===b?[]:D.apply(this,arguments)}}if("".substr&&"b"!=="0b".substr(-1)){var E=String.prototype.substr;String.prototype.substr=function(a,b){return E.call(this,0>a?0>(a=this.length+a)?0:a:a,b)}}if(j="	\n\f\r   ᠎             　\u2028\u2029﻿",!String.prototype.trim||j.trim()){j="["+j+"]";var F=RegExp("^"+j+j+"*"),G=RegExp(j+j+"*$");String.prototype.trim=function(){if(this===void 0||null===this)throw new TypeError("can't convert "+this+" to object");return(this+"").replace(F,"").replace(G,"")}}var n=function(a){if(null==a)throw new TypeError("can't convert "+a+" to object");return Object(a)}}),function(f){"function"==typeof define?define(f):"function"==typeof YUI?YUI.add("es5-sham",f):f()}(function(){function f(a){try{return Object.defineProperty(a,"sentinel",{}),"sentinel"in a}catch(c){}}var p,q,k,l,i,b=Function.prototype.call,g=Object.prototype,h=b.bind(g.hasOwnProperty);if((i=h(g,"__defineGetter__"))&&(p=b.bind(g.__defineGetter__),q=b.bind(g.__defineSetter__),k=b.bind(g.__lookupGetter__),l=b.bind(g.__lookupSetter__)),Object.getPrototypeOf||(Object.getPrototypeOf=function(a){return a.__proto__||(a.constructor?a.constructor.prototype:g)}),Object.getOwnPropertyDescriptor||(Object.getOwnPropertyDescriptor=function(a,c){if("object"!=typeof a&&"function"!=typeof a||null===a)throw new TypeError("Object.getOwnPropertyDescriptor called on a non-object: "+a);if(h(a,c)){var d={enumerable:!0,configurable:!0};if(i){var b=a.__proto__;a.__proto__=g;var e=k(a,c),f=l(a,c);if(a.__proto__=b,e||f)return e&&(d.get=e),f&&(d.set=f),d}return d.value=a[c],d}}),Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(a){return Object.keys(a)}),!Object.create){var m;if(null===Object.prototype.__proto__||"undefined"==typeof document)m=function(){return{__proto__:null}};else{var r=function(){},b=document.createElement("iframe"),j=document.body||document.documentElement;b.style.display="none",j.appendChild(b),b.src="javascript:";var e=b.contentWindow.Object.prototype;j.removeChild(b),b=null,delete e.constructor,delete e.hasOwnProperty,delete e.propertyIsEnumerable,delete e.isPrototypeOf,delete e.toLocaleString,delete e.toString,delete e.valueOf,e.__proto__=null,r.prototype=e,m=function(){return new r}}Object.create=function(a,c){function d(){}var b;if(null===a)b=m();else{if("object"!=typeof a&&"function"!=typeof a)throw new TypeError("Object prototype may only be an Object or null");d.prototype=a,b=new d,b.__proto__=a}return c!==void 0&&Object.defineProperties(b,c),b}}if(Object.defineProperty&&(b=f({}),j="undefined"==typeof document||f(document.createElement("div")),!b||!j))var n=Object.defineProperty,o=Object.defineProperties;(!Object.defineProperty||n)&&(Object.defineProperty=function(a,c,d){if("object"!=typeof a&&"function"!=typeof a||null===a)throw new TypeError("Object.defineProperty called on non-object: "+a);if("object"!=typeof d&&"function"!=typeof d||null===d)throw new TypeError("Property description must be an object: "+d);if(n)try{return n.call(Object,a,c,d)}catch(b){}if(h(d,"value"))if(i&&(k(a,c)||l(a,c))){var e=a.__proto__;a.__proto__=g,delete a[c],a[c]=d.value,a.__proto__=e}else a[c]=d.value;else{if(!i)throw new TypeError("getters & setters can not be defined on this javascript engine");h(d,"get")&&p(a,c,d.get),h(d,"set")&&q(a,c,d.set)}return a}),(!Object.defineProperties||o)&&(Object.defineProperties=function(a,c){if(o)try{return o.call(Object,a,c)}catch(d){}for(var b in c)h(c,b)&&"__proto__"!=b&&Object.defineProperty(a,b,c[b]);return a}),Object.seal||(Object.seal=function(a){return a}),Object.freeze||(Object.freeze=function(a){return a});try{Object.freeze(function(){})}catch(t){var s=Object.freeze;Object.freeze=function(a){return"function"==typeof a?a:s(a)}}Object.preventExtensions||(Object.preventExtensions=function(a){return a}),Object.isSealed||(Object.isSealed=function(){return!1}),Object.isFrozen||(Object.isFrozen=function(){return!1}),Object.isExtensible||(Object.isExtensible=function(a){if(Object(a)!==a)throw new TypeError;for(var c="";h(a,c);)c+="?";a[c]=!0;var b=h(a,c);return delete a[c],b})});var PIXI=PIXI||{};PIXI.Point=function(x,y){this.x=x||0,this.y=y||0},PIXI.Point.clone=function(){return new PIXI.Point(this.x,this.y)},PIXI.Point.constructor=PIXI.Point,PIXI.Rectangle=function(x,y,width,height){this.x=x||0,this.y=y||0,this.width=width||0,this.height=height||0},PIXI.Rectangle.clone=function(){return new PIXI.Rectangle(this.x,this.y,this.width,this.height)},PIXI.Rectangle.constructor=PIXI.Rectangle,PIXI.DisplayObject=function(){this.position=new PIXI.Point,this.scale=new PIXI.Point(1,1),this.rotation=0,this.alpha=1,this.visible=!0,this.cacheVisible=!1,this.parent=null,this.stage=null,this.hitArea=null,this.worldAlpha=1,this.color=[],this.worldTransform=PIXI.mat3.create(),this.localTransform=PIXI.mat3.create(),this.dynamic=!0,this._sr=0,this._cr=1,this.renderable=!1,this.interactive=!1,this.buttonMode=!1},PIXI.DisplayObject.constructor=PIXI.DisplayObject,PIXI.DisplayObject.prototype.setInteractive=function(interactive){this.interactive=interactive,this.stage&&(this.stage.dirty=!0)},PIXI.DisplayObject.prototype.updateTransform=function(){this.rotation!=this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var localTransform=this.localTransform,parentTransform=this.parent.worldTransform,worldTransform=this.worldTransform;localTransform[0]=this._cr*this.scale.x,localTransform[1]=-this._sr*this.scale.y,localTransform[3]=this._sr*this.scale.x,localTransform[4]=this._cr*this.scale.y,localTransform[2]=this.position.x,localTransform[5]=this.position.y;var a00=localTransform[0],a01=localTransform[1],a02=localTransform[2],a10=localTransform[3],a11=localTransform[4],a12=localTransform[5],b00=parentTransform[0],b01=parentTransform[1],b02=parentTransform[2],b10=parentTransform[3],b11=parentTransform[4],b12=parentTransform[5];worldTransform[0]=b00*a00+b01*a10,worldTransform[1]=b00*a01+b01*a11,worldTransform[2]=b00*a02+b01*a12+b02,worldTransform[3]=b10*a00+b11*a10,worldTransform[4]=b10*a01+b11*a11,worldTransform[5]=b10*a02+b11*a12+b12,this.worldAlpha=this.alpha*this.parent.worldAlpha},PIXI.DisplayObjectContainer=function(){PIXI.DisplayObject.call(this),this.children=[],this.renderable=!1},PIXI.DisplayObjectContainer.constructor=PIXI.DisplayObjectContainer,PIXI.DisplayObjectContainer.prototype=Object.create(PIXI.DisplayObject.prototype),PIXI.DisplayObjectContainer.prototype.addChild=function(child){child.parent!=undefined&&child.parent.removeChild(child),child.parent=this,child.childIndex=this.children.length,this.children.push(child),this.stage&&this.stage.__addChild(child)},PIXI.DisplayObjectContainer.prototype.addChildAt=function(child,index){if(!(index>=0&&this.children.length>=index))throw Error(child+" The index "+index+" supplied is out of bounds "+this.children.length);child.parent!=undefined&&child.parent.removeChild(child),index==this.children.length?this.children.push(child):this.children.splice(index,0,child),child.parent=this,child.childIndex=index;for(var length=this.children.length,i=index;length>i;i++)this.children[i].childIndex=i;this.stage&&this.stage.__addChild(child)},PIXI.DisplayObjectContainer.prototype.removeChild=function(child){var index=this.children.indexOf(child);if(-1===index)throw Error(child+" The supplied DisplayObject must be a child of the caller "+this);this.stage&&this.stage.__removeChild(child),child.parent=undefined,this.children.splice(index,1);for(var i=index,j=this.children.length;j>i;i++)this.children[i].childIndex-=1},PIXI.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible){PIXI.DisplayObject.prototype.updateTransform.call(this);for(var i=0,j=this.children.length;j>i;i++)this.children[i].updateTransform()}},PIXI.blendModes={},PIXI.blendModes.NORMAL=0,PIXI.blendModes.SCREEN=1,PIXI.Sprite=function(texture){PIXI.DisplayObjectContainer.call(this),this.anchor=new PIXI.Point,this.texture=texture,this.blendMode=PIXI.blendModes.NORMAL,this.width=0,this.height=0,texture.baseTexture.hasLoaded?(this.width=this.texture.frame.width,this.height=this.texture.frame.height,this.updateFrame=!0):(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},PIXI.Sprite.constructor=PIXI.Sprite,PIXI.Sprite.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),PIXI.Sprite.prototype.setTexture=function(texture){this.texture.baseTexture!=texture.baseTexture&&(this.textureChange=!0),this.texture=texture,this.width=texture.frame.width,this.height=texture.frame.height,this.updateFrame=!0},PIXI.Sprite.prototype.onTextureUpdate=function(){this.width=this.width||this.texture.frame.width,this.height=this.height||this.texture.frame.height,this.updateFrame=!0},PIXI.Sprite.fromFrame=function(frameId){var texture=PIXI.TextureCache[frameId];if(!texture)throw Error("The frameId '"+frameId+"' does not exist in the texture cache"+this);return new PIXI.Sprite(texture)},PIXI.Sprite.fromImage=function(imageId){var texture=PIXI.Texture.fromImage(imageId);return new PIXI.Sprite(texture)},PIXI.MovieClip=function(textures){PIXI.Sprite.call(this,textures[0]),this.textures=textures,this.currentFrame=0,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this.playing},PIXI.MovieClip.constructor=PIXI.MovieClip,PIXI.MovieClip.prototype=Object.create(PIXI.Sprite.prototype),PIXI.MovieClip.prototype.stop=function(){this.playing=!1},PIXI.MovieClip.prototype.play=function(){this.playing=!0},PIXI.MovieClip.prototype.gotoAndStop=function(frameNumber){this.playing=!1,this.currentFrame=frameNumber;var round=0|this.currentFrame+.5;this.setTexture(this.textures[round%this.textures.length])},PIXI.MovieClip.prototype.gotoAndPlay=function(frameNumber){this.currentFrame=frameNumber,this.playing=!0},PIXI.MovieClip.prototype.updateTransform=function(){if(PIXI.Sprite.prototype.updateTransform.call(this),this.playing){this.currentFrame+=this.animationSpeed;var round=0|this.currentFrame+.5;this.loop||this.textures.length>round?this.setTexture(this.textures[round%this.textures.length]):round>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}},PIXI.InteractionManager=function(stage){this.stage=stage,this.tempPoint=new PIXI.Point,this.mouseoverEnabled=!0,this.mouse=new PIXI.InteractionData,this.touchs={},this.pool=[],this.interactiveItems=[],this.last=0},PIXI.InteractionManager.constructor=PIXI.InteractionManager,PIXI.InteractionManager.prototype.collectInteractiveSprite=function(displayObject,iParent){for(var children=displayObject.children,length=children.length,i=length-1;i>=0;i--){var child=children[i];child.interactive?(iParent.interactiveChildren=!0,this.interactiveItems.push(child),child.children.length>0&&this.collectInteractiveSprite(child,child)):(child.__iParent=null,child.children.length>0&&this.collectInteractiveSprite(child,iParent))}},PIXI.InteractionManager.prototype.setTarget=function(target){window.navigator.msPointerEnabled&&(target.view.style["-ms-content-zooming"]="none",target.view.style["-ms-touch-action"]="none"),this.target=target,target.view.addEventListener("mousemove",this.onMouseMove.bind(this),!0),target.view.addEventListener("mousedown",this.onMouseDown.bind(this),!0),document.body.addEventListener("mouseup",this.onMouseUp.bind(this),!0),target.view.addEventListener("mouseout",this.onMouseUp.bind(this),!0),target.view.addEventListener("touchstart",this.onTouchStart.bind(this),!0),target.view.addEventListener("touchend",this.onTouchEnd.bind(this),!0),target.view.addEventListener("touchmove",this.onTouchMove.bind(this),!0)},PIXI.InteractionManager.prototype.update=function(){var now=Date.now(),diff=now-this.last;if(diff=30*diff/1e3,!(1>diff)){if(this.last=now,this.dirty){this.dirty=!1,this.interactiveItems.length;for(var i=0;this.interactiveItems.length>i;i++)this.interactiveItems[i].interactiveChildren=!0;this.interactiveItems=[],this.stage.interactive&&this.interactiveItems.push(this.stage),this.collectInteractiveSprite(this.stage,this.stage)}for(var length=this.interactiveItems.length,i=0;length>i;i++){var item=this.interactiveItems[i];item.visible&&(item.mouseover||item.mouseout||item.buttonMode)&&(item.__hit=this.hitTest(item,this.mouse),item.__hit?item.__isOver||(item.buttonMode&&(this.target.view.style.cursor="pointer"),item.mouseover&&item.mouseover(this.mouse),item.__isOver=!0):item.__isOver&&(item.buttonMode&&(this.target.view.style.cursor="default"),item.mouseout&&item.mouseout(this.mouse),item.__isOver=!1))}}},PIXI.InteractionManager.prototype.onMouseMove=function(event){event.preventDefault();var rect=this.target.view.getBoundingClientRect();this.mouse.global.x=(event.clientX-rect.left)*(this.target.width/rect.width),this.mouse.global.y=(event.clientY-rect.top)*(this.target.height/rect.height);var length=this.interactiveItems.length;this.mouse.global;for(var i=0;length>i;i++){var item=this.interactiveItems[i];item.mousemove&&item.mousemove(this.mouse)}},PIXI.InteractionManager.prototype.onMouseDown=function(event){event.preventDefault();var length=this.interactiveItems.length;this.mouse.global,this.stage;for(var i=0;length>i;i++){var item=this.interactiveItems[i];if((item.mousedown||item.click)&&(item.__mouseIsDown=!0,item.__hit=this.hitTest(item,this.mouse),item.__hit&&(item.mousedown&&item.mousedown(this.mouse),item.__isDown=!0,!item.interactiveChildren)))break}},PIXI.InteractionManager.prototype.onMouseUp=function(event){event.preventDefault(),this.mouse.global;for(var length=this.interactiveItems.length,up=!1,i=0;length>i;i++){var item=this.interactiveItems[i];(item.mouseup||item.mouseupoutside||item.click)&&(item.__hit=this.hitTest(item,this.mouse),item.__hit&&!up?(item.mouseup&&item.mouseup(this.mouse),item.__isDown&&item.click&&item.click(this.mouse),item.interactiveChildren||(up=!0)):item.__isDown&&item.mouseupoutside&&item.mouseupoutside(this.mouse),item.__isDown=!1)}},PIXI.InteractionManager.prototype.hitTest=function(item,interactionData){var global=interactionData.global;if(!item.visible)return!1;if(item instanceof PIXI.Sprite){var worldTransform=item.worldTransform,a00=worldTransform[0],a01=worldTransform[1],a02=worldTransform[2],a10=worldTransform[3],a11=worldTransform[4],a12=worldTransform[5],id=1/(a00*a11+a01*-a10),x=a11*id*global.x+-a01*id*global.y+(a12*a01-a02*a11)*id,y=a00*id*global.y+-a10*id*global.x+(-a12*a00+a02*a10)*id,x1=-item.width*item.anchor.x;if(x>x1&&x1+item.width>x){var y1=-item.height*item.anchor.y;if(y>y1&&y1+item.height>y)return!0}}else if(item.hitArea){var worldTransform=item.worldTransform,hitArea=item.hitArea,a00=worldTransform[0],a01=worldTransform[1],a02=worldTransform[2],a10=worldTransform[3],a11=worldTransform[4],a12=worldTransform[5],id=1/(a00*a11+a01*-a10),x=a11*id*global.x+-a01*id*global.y+(a12*a01-a02*a11)*id,y=a00*id*global.y+-a10*id*global.x+(-a12*a00+a02*a10)*id,x1=hitArea.x;if(x>x1&&x1+hitArea.width>x){var y1=hitArea.y;if(y>y1&&y1+hitArea.height>y)return!0}}for(var length=item.children.length,i=0;length>i;i++){var item=item.children[i],hit=this.hitTest(item,interactionData);if(hit)return!0}return!1},PIXI.InteractionManager.prototype.onTouchMove=function(event){event.preventDefault();for(var rect=this.target.view.getBoundingClientRect(),changedTouches=event.changedTouches,i=0;changedTouches.length>i;i++){var touchEvent=changedTouches[i],touchData=this.touchs[touchEvent.identifier];touchData.global.x=(touchEvent.clientX-rect.left)*(this.target.width/rect.width),touchData.global.y=(touchEvent.clientY-rect.top)*(this.target.height/rect.height)}for(var length=this.interactiveItems.length,i=0;length>i;i++){var item=this.interactiveItems[i];item.touchmove&&item.touchmove(touchData)}},PIXI.InteractionManager.prototype.onTouchStart=function(event){event.preventDefault();for(var rect=this.target.view.getBoundingClientRect(),changedTouches=event.changedTouches,i=0;changedTouches.length>i;i++){var touchEvent=changedTouches[i],touchData=this.pool.pop();touchData||(touchData=new PIXI.InteractionData),this.touchs[touchEvent.identifier]=touchData,touchData.global.x=(touchEvent.clientX-rect.left)*(this.target.width/rect.width),touchData.global.y=(touchEvent.clientY-rect.top)*(this.target.height/rect.height);for(var length=this.interactiveItems.length,j=0;length>j;j++){var item=this.interactiveItems[j];if((item.touchstart||item.tap)&&(item.__hit=this.hitTest(item,touchData),item.__hit&&(item.touchstart&&item.touchstart(touchData),item.__isDown=!0,item.__touchData=touchData,!item.interactiveChildren)))break}}},PIXI.InteractionManager.prototype.onTouchEnd=function(event){event.preventDefault();for(var rect=this.target.view.getBoundingClientRect(),changedTouches=event.changedTouches,i=0;changedTouches.length>i;i++){var touchEvent=changedTouches[i],touchData=this.touchs[touchEvent.identifier],up=!1;touchData.global.x=(touchEvent.clientX-rect.left)*(this.target.width/rect.width),touchData.global.y=(touchEvent.clientY-rect.top)*(this.target.height/rect.height);for(var length=this.interactiveItems.length,j=0;length>j;j++){var item=this.interactiveItems[j],itemTouchData=item.__touchData;item.__hit=this.hitTest(item,touchData),itemTouchData==touchData&&((item.touchend||item.tap)&&(item.__hit&&!up?(item.touchend&&item.touchend(touchData),item.__isDown&&item.tap&&item.tap(touchData),item.interactiveChildren||(up=!0)):item.__isDown&&item.touchendoutside&&item.touchendoutside(touchData),item.__isDown=!1),item.__touchData=null)}this.pool.push(touchData),this.touchs[touchEvent.identifier]=null}},PIXI.InteractionData=function(){this.global=new PIXI.Point,this.local=new PIXI.Point,this.target},PIXI.InteractionData.prototype.getLocalPosition=function(displayObject){var worldTransform=displayObject.worldTransform,global=this.global,a00=worldTransform[0],a01=worldTransform[1],a02=worldTransform[2],a10=worldTransform[3],a11=worldTransform[4],a12=worldTransform[5],id=1/(a00*a11+a01*-a10);return new PIXI.Point(a11*id*global.x+-a01*id*global.y+(a12*a01-a02*a11)*id,a00*id*global.y+-a10*id*global.x+(-a12*a00+a02*a10)*id)},PIXI.InteractionData.constructor=PIXI.InteractionData,PIXI.Stage=function(backgroundColor,interactive){PIXI.DisplayObjectContainer.call(this),this.worldTransform=PIXI.mat3.create(),this.__childrenAdded=[],this.__childrenRemoved=[],this.childIndex=0,this.stage=this,this.stage.hitArea=new PIXI.Rectangle(0,0,1e5,1e5),this.interactive=!!interactive,this.interactionManager=new PIXI.InteractionManager(this),this.setBackgroundColor(backgroundColor)},PIXI.Stage.constructor=PIXI.Stage,PIXI.Stage.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),PIXI.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var i=0,j=this.children.length;j>i;i++)this.children[i].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},PIXI.Stage.prototype.setBackgroundColor=function(backgroundColor){this.backgroundColor=backgroundColor||0,this.backgroundColorSplit=HEXtoRGB(this.backgroundColor),this.backgroundColorString="#"+this.backgroundColor.toString(16)},PIXI.Stage.prototype.__addChild=function(child){if(child.interactive&&(this.dirty=!0),child.stage=this,child.children)for(var i=0;child.children.length>i;i++)this.__addChild(child.children[i])},PIXI.Stage.prototype.__removeChild=function(child){if(child.interactive&&(this.dirty=!0),this.__childrenRemoved.push(child),child.stage=undefined,child.children)for(var i=0,j=child.children.length;j>i;i++)this.__removeChild(child.children[i])},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){window.setTimeout(callback,1e3/60)}}(),"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){var slice=Array.prototype.slice;return function(thisArg){function bound(){var args=boundArgs.concat(slice.call(arguments));target.apply(this instanceof bound?this:thisArg,args)}var target=this,boundArgs=slice.call(arguments,1);if("function"!=typeof target)throw new TypeError;return bound.prototype=function F(proto){return proto&&(F.prototype=proto),this instanceof F?undefined:new F}(target.prototype),bound}}());var AjaxRequest=function(){var activexmodes=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new XMLHttpRequest:!1;for(var i=0;activexmodes.length>i;i++)try{return new ActiveXObject(activexmodes[i])}catch(e){}};if(PIXI.EventTarget=function(){var listeners={};this.addEventListener=this.on=function(type,listener){listeners[type]===undefined&&(listeners[type]=[]),-1===listeners[type].indexOf(listener)&&listeners[type].push(listener)},this.dispatchEvent=this.emit=function(event){for(var listener in listeners[event.type])listeners[event.type][listener](event)},this.removeEventListener=this.off=function(type,listener){var index=listeners[type].indexOf(listener);-1!==index&&listeners[type].splice(index,1)}},determineMatrixArrayType(),PIXI.mat3={},PIXI.mat3.create=function(){var matrix=new PIXI.Matrix(9);return matrix[0]=1,matrix[1]=0,matrix[2]=0,matrix[3]=0,matrix[4]=1,matrix[5]=0,matrix[6]=0,matrix[7]=0,matrix[8]=1,matrix},PIXI.mat4={},PIXI.mat4.create=function(){var matrix=new PIXI.Matrix(16);return matrix[0]=1,matrix[1]=0,matrix[2]=0,matrix[3]=0,matrix[4]=0,matrix[5]=1,matrix[6]=0,matrix[7]=0,matrix[8]=0,matrix[9]=0,matrix[10]=1,matrix[11]=0,matrix[12]=0,matrix[13]=0,matrix[14]=0,matrix[15]=1,matrix},PIXI.mat3.multiply=function(mat,mat2,dest){dest||(dest=mat);var a00=mat[0],a01=mat[1],a02=mat[2],a10=mat[3],a11=mat[4],a12=mat[5],a20=mat[6],a21=mat[7],a22=mat[8],b00=mat2[0],b01=mat2[1],b02=mat2[2],b10=mat2[3],b11=mat2[4],b12=mat2[5],b20=mat2[6],b21=mat2[7],b22=mat2[8];return dest[0]=b00*a00+b01*a10+b02*a20,dest[1]=b00*a01+b01*a11+b02*a21,dest[2]=b00*a02+b01*a12+b02*a22,dest[3]=b10*a00+b11*a10+b12*a20,dest[4]=b10*a01+b11*a11+b12*a21,dest[5]=b10*a02+b11*a12+b12*a22,dest[6]=b20*a00+b21*a10+b22*a20,dest[7]=b20*a01+b21*a11+b22*a21,dest[8]=b20*a02+b21*a12+b22*a22,dest},PIXI.mat3.toMat4=function(mat,dest){return dest||(dest=PIXI.mat4.create()),dest[15]=1,dest[14]=0,dest[13]=0,dest[12]=0,dest[11]=0,dest[10]=mat[8],dest[9]=mat[7],dest[8]=mat[6],dest[7]=0,dest[6]=mat[5],dest[5]=mat[4],dest[4]=mat[3],dest[3]=0,dest[2]=mat[2],dest[1]=mat[1],dest[0]=mat[0],dest},PIXI.mat4.create=function(){var matrix=new PIXI.Matrix(16);return matrix[0]=1,matrix[1]=0,matrix[2]=0,matrix[3]=0,matrix[4]=0,matrix[5]=1,matrix[6]=0,matrix[7]=0,matrix[8]=0,matrix[9]=0,matrix[10]=1,matrix[11]=0,matrix[12]=0,matrix[13]=0,matrix[14]=0,matrix[15]=1,matrix},PIXI.mat4.transpose=function(mat,dest){if(!dest||mat===dest){var a01=mat[1],a02=mat[2],a03=mat[3],a12=mat[6],a13=mat[7],a23=mat[11];return mat[1]=mat[4],mat[2]=mat[8],mat[3]=mat[12],mat[4]=a01,mat[6]=mat[9],mat[7]=mat[13],mat[8]=a02,mat[9]=a12,mat[11]=mat[14],mat[12]=a03,mat[13]=a13,mat[14]=a23,mat}return dest[0]=mat[0],dest[1]=mat[4],dest[2]=mat[8],dest[3]=mat[12],dest[4]=mat[1],dest[5]=mat[5],dest[6]=mat[9],dest[7]=mat[13],dest[8]=mat[2],dest[9]=mat[6],dest[10]=mat[10],dest[11]=mat[14],dest[12]=mat[3],dest[13]=mat[7],dest[14]=mat[11],dest[15]=mat[15],dest},PIXI.mat4.multiply=function(mat,mat2,dest){dest||(dest=mat);var a00=mat[0],a01=mat[1],a02=mat[2],a03=mat[3],a10=mat[4],a11=mat[5],a12=mat[6],a13=mat[7],a20=mat[8],a21=mat[9],a22=mat[10],a23=mat[11],a30=mat[12],a31=mat[13],a32=mat[14],a33=mat[15],b0=mat2[0],b1=mat2[1],b2=mat2[2],b3=mat2[3];return dest[0]=b0*a00+b1*a10+b2*a20+b3*a30,dest[1]=b0*a01+b1*a11+b2*a21+b3*a31,dest[2]=b0*a02+b1*a12+b2*a22+b3*a32,dest[3]=b0*a03+b1*a13+b2*a23+b3*a33,b0=mat2[4],b1=mat2[5],b2=mat2[6],b3=mat2[7],dest[4]=b0*a00+b1*a10+b2*a20+b3*a30,dest[5]=b0*a01+b1*a11+b2*a21+b3*a31,dest[6]=b0*a02+b1*a12+b2*a22+b3*a32,dest[7]=b0*a03+b1*a13+b2*a23+b3*a33,b0=mat2[8],b1=mat2[9],b2=mat2[10],b3=mat2[11],dest[8]=b0*a00+b1*a10+b2*a20+b3*a30,dest[9]=b0*a01+b1*a11+b2*a21+b3*a31,dest[10]=b0*a02+b1*a12+b2*a22+b3*a32,dest[11]=b0*a03+b1*a13+b2*a23+b3*a33,b0=mat2[12],b1=mat2[13],b2=mat2[14],b3=mat2[15],dest[12]=b0*a00+b1*a10+b2*a20+b3*a30,dest[13]=b0*a01+b1*a11+b2*a21+b3*a31,dest[14]=b0*a02+b1*a12+b2*a22+b3*a32,dest[15]=b0*a03+b1*a13+b2*a23+b3*a33,dest
},PIXI.autoDetectRenderer=function(width,height,view,transparent){width||(width=800),height||(height=600);var webgl=function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return!1}}();return webgl?new PIXI.WebGLRenderer(width,height,view,transparent):new PIXI.CanvasRenderer(width,height,view,transparent)},PIXI.shaderFragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","gl_FragColor = gl_FragColor * vColor;","}"],PIXI.shaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform mat4 uMVMatrix;","varying vec2 vTextureCoord;","varying float vColor;","void main(void) {","gl_Position = uMVMatrix * vec4(aVertexPosition, 1.0, 1.0);","vTextureCoord = aTextureCoord;","vColor = aColor;","}"],PIXI.CompileVertexShader=function(gl,shaderSrc){for(var src="",i=0;shaderSrc.length>i;i++)src+=shaderSrc[i];var shader;return shader=gl.createShader(gl.VERTEX_SHADER),gl.shaderSource(shader,src),gl.compileShader(shader),gl.getShaderParameter(shader,gl.COMPILE_STATUS)?shader:(alert(gl.getShaderInfoLog(shader)),null)},PIXI.CompileFragmentShader=function(gl,shaderSrc){for(var src="",i=0;shaderSrc.length>i;i++)src+=shaderSrc[i];var shader;return shader=gl.createShader(gl.FRAGMENT_SHADER),gl.shaderSource(shader,src),gl.compileShader(shader),gl.getShaderParameter(shader,gl.COMPILE_STATUS)?shader:(alert(gl.getShaderInfoLog(shader)),null)},PIXI._defaultFrame=new PIXI.Rectangle(0,0,1,1),PIXI.WebGLRenderer=function(width,height,view,transparent){this.transparent=!!transparent,this.width=width||800,this.height=height||600,this.view=view||document.createElement("canvas"),this.view.width=this.width,this.view.height=this.height;var scope=this;this.view.addEventListener("webglcontextlost",function(event){scope.handleContextLost(event)},!1),this.view.addEventListener("webglcontextrestored",function(event){scope.handleContextRestored(event)},!1),this.batchs=[];try{this.gl=this.view.getContext("experimental-webgl",{alpha:this.transparent,antialias:!1,premultipliedAlpha:!0})}catch(e){throw Error(" This browser does not support webGL. Try using the canvas renderer"+this)}this.initShaders();var gl=this.gl;this.batch=new PIXI.WebGLBatch(gl),gl.disable(gl.DEPTH_TEST),gl.enable(gl.BLEND),gl.colorMask(!0,!0,!0,this.transparent),this.projectionMatrix=PIXI.mat4.create(),this.resize(this.width,this.height),this.contextLost=!1},PIXI.WebGLRenderer.constructor=PIXI.WebGLRenderer,PIXI.WebGLRenderer.prototype.initShaders=function(){var gl=this.gl,fragmentShader=PIXI.CompileFragmentShader(gl,PIXI.shaderFragmentSrc),vertexShader=PIXI.CompileVertexShader(gl,PIXI.shaderVertexSrc);this.shaderProgram=gl.createProgram();var shaderProgram=this.shaderProgram;gl.attachShader(shaderProgram,vertexShader),gl.attachShader(shaderProgram,fragmentShader),gl.linkProgram(shaderProgram),gl.getProgramParameter(shaderProgram,gl.LINK_STATUS)||alert("Could not initialise shaders"),gl.useProgram(shaderProgram),shaderProgram.vertexPositionAttribute=gl.getAttribLocation(shaderProgram,"aVertexPosition"),gl.enableVertexAttribArray(shaderProgram.vertexPositionAttribute),shaderProgram.textureCoordAttribute=gl.getAttribLocation(shaderProgram,"aTextureCoord"),gl.enableVertexAttribArray(shaderProgram.textureCoordAttribute),shaderProgram.colorAttribute=gl.getAttribLocation(shaderProgram,"aColor"),gl.enableVertexAttribArray(shaderProgram.colorAttribute),shaderProgram.mvMatrixUniform=gl.getUniformLocation(shaderProgram,"uMVMatrix"),shaderProgram.samplerUniform=gl.getUniformLocation(shaderProgram,"uSampler"),PIXI.shaderProgram=this.shaderProgram},PIXI.WebGLRenderer.prototype.checkVisibility=function(displayObject,globalVisible){for(var children=displayObject.children,i=0;children.length>i;i++){var child=children[i],actualVisibility=child.visible&&globalVisible;child.textureChange&&(child.textureChange=!1,actualVisibility&&(this.removeDisplayObject(child),this.addDisplayObject(child))),child.cacheVisible!=actualVisibility&&(child.cacheVisible=actualVisibility,child.cacheVisible?this.addDisplayObject(child):this.removeDisplayObject(child)),child.children.length>0&&this.checkVisibility(child,actualVisibility)}},PIXI.WebGLRenderer.prototype.render=function(stage){if(!this.contextLost){this.__stage!==stage&&(this.__stage&&this.checkVisibility(this.__stage,!1),this.__stage=stage);for(var i=0;stage.__childrenRemoved.length>i;i++)this.removeDisplayObject(stage.__childrenRemoved[i]);for(var i=0;PIXI.texturesToUpdate.length>i;i++)this.updateTexture(PIXI.texturesToUpdate[i]);stage.__childrenRemoved=[],stage.__childrenAdded=[],PIXI.texturesToUpdate=[],this.checkVisibility(stage,!0),stage.updateTransform();var gl=this.gl;gl.clear(gl.COLOR_BUFFER_BIT),gl.clearColor(stage.backgroundColorSplit[0],stage.backgroundColorSplit[1],stage.backgroundColorSplit[2],0),gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA),gl.uniformMatrix4fv(this.shaderProgram.mvMatrixUniform,!1,this.projectionMatrix);for(var renderable,i=0;this.batchs.length>i;i++)renderable=this.batchs[i],renderable instanceof PIXI.WebGLBatch?this.batchs[i].render():renderable instanceof PIXI.Strip&&renderable.visible&&this.renderStrip(renderable);stage.interactive&&(stage._interactiveEventsAdded||(stage._interactiveEventsAdded=!0,stage.interactionManager.setTarget(this)))}},PIXI.WebGLRenderer.prototype.updateTexture=function(texture){var gl=this.gl;texture._glTexture||(texture._glTexture=gl.createTexture()),texture.hasLoaded&&(gl.bindTexture(gl.TEXTURE_2D,texture._glTexture),gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,texture.source),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.bindTexture(gl.TEXTURE_2D,null)),this.refreshBatchs=!0},PIXI.WebGLRenderer.prototype.addDisplayObject=function(displayObject){if(displayObject.stage&&!displayObject.__inWebGL&&(displayObject.batch=null,displayObject.renderable)){displayObject.__inWebGL=!0;var previousSprite=displayObject;do{if(0==previousSprite.childIndex)previousSprite=previousSprite.parent;else for(previousSprite=previousSprite.parent.children[previousSprite.childIndex-1];0!=previousSprite.children.length;)previousSprite=previousSprite.children[previousSprite.children.length-1];if(previousSprite==displayObject.stage)break}while(!previousSprite.renderable||!previousSprite.__inWebGL);var nextSprite=displayObject;do{if(0==nextSprite.children.length){for(;nextSprite.childIndex==nextSprite.parent.children.length-1;)if(nextSprite=nextSprite.parent,nextSprite==displayObject.stage){nextSprite=null;break}nextSprite&&(nextSprite=nextSprite.parent.children[nextSprite.childIndex+1])}else nextSprite=nextSprite.children[0];if(!nextSprite)break}while(!nextSprite.renderable||!nextSprite.__inWebGL);if(displayObject instanceof PIXI.Sprite){var previousBatch,nextBatch;if(previousSprite instanceof PIXI.Sprite){if(previousBatch=previousSprite.batch,previousBatch&&previousBatch.texture==displayObject.texture.baseTexture&&previousBatch.blendMode==displayObject.blendMode)return previousBatch.insertAfter(displayObject,previousSprite),undefined}else previousBatch=previousSprite;if(nextSprite)if(nextSprite instanceof PIXI.Sprite){if(nextBatch=nextSprite.batch){if(nextBatch.texture==displayObject.texture.baseTexture&&nextBatch.blendMode==displayObject.blendMode)return nextBatch.insertBefore(displayObject,nextSprite),undefined;if(nextBatch==previousBatch){var splitBatch=previousBatch.split(nextSprite),batch=PIXI._getBatch(this.gl),index=this.batchs.indexOf(previousBatch);return batch.init(displayObject),this.batchs.splice(index+1,0,batch,splitBatch),undefined}}}else nextBatch=nextSprite;var batch=PIXI._getBatch(this.gl);if(batch.init(displayObject),previousBatch){var index=this.batchs.indexOf(previousBatch);this.batchs.splice(index+1,0,batch)}else this.batchs.push(batch)}else displayObject instanceof PIXI.Strip&&(this.initStrip(displayObject),this.batchs.push(displayObject));this.batchUpdate=!0}},PIXI.WebGLRenderer.prototype.removeDisplayObject=function(displayObject){if(displayObject.cacheVisible=!1,displayObject.renderable){displayObject.__inWebGL=!1;var batchToRemove;if(displayObject instanceof PIXI.Sprite){var batch=displayObject.batch;if(!batch)return;batch.remove(displayObject),0==batch.size&&(batchToRemove=batch)}else batchToRemove=displayObject;if(batchToRemove){var index=this.batchs.indexOf(batchToRemove);if(-1==index)return;if(0==index||index==this.batchs.length-1)return this.batchs.splice(index,1),batchToRemove instanceof PIXI.WebGLBatch&&PIXI._returnBatch(batchToRemove),undefined;if(this.batchs[index-1]instanceof PIXI.WebGLBatch&&this.batchs[index+1]instanceof PIXI.WebGLBatch&&this.batchs[index-1].texture==this.batchs[index+1].texture&&this.batchs[index-1].blendMode==this.batchs[index+1].blendMode)return this.batchs[index-1].merge(this.batchs[index+1]),batchToRemove instanceof PIXI.WebGLBatch&&PIXI._returnBatch(batchToRemove),PIXI._returnBatch(this.batchs[index+1]),this.batchs.splice(index,2),undefined;this.batchs.splice(index,1),batchToRemove instanceof PIXI.WebGLBatch&&PIXI._returnBatch(batchToRemove)}}},PIXI.WebGLRenderer.prototype.resize=function(width,height){this.width=width,this.height=height,this.view.width=width,this.view.height=height,this.gl.viewport(0,0,this.width,this.height);var projectionMatrix=this.projectionMatrix;projectionMatrix[0]=2/this.width,projectionMatrix[5]=-2/this.height,projectionMatrix[12]=-1,projectionMatrix[13]=1},PIXI.WebGLRenderer.prototype.initStrip=function(strip){var gl=this.gl;this.shaderProgram,strip._vertexBuffer=gl.createBuffer(),strip._indexBuffer=gl.createBuffer(),strip._uvBuffer=gl.createBuffer(),strip._colorBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,strip._vertexBuffer),gl.bufferData(gl.ARRAY_BUFFER,strip.verticies,gl.DYNAMIC_DRAW),gl.bindBuffer(gl.ARRAY_BUFFER,strip._uvBuffer),gl.bufferData(gl.ARRAY_BUFFER,strip.uvs,gl.STATIC_DRAW),gl.bindBuffer(gl.ARRAY_BUFFER,strip._colorBuffer),gl.bufferData(gl.ARRAY_BUFFER,strip.colors,gl.STATIC_DRAW),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,strip._indexBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,strip.indices,gl.STATIC_DRAW)},PIXI.WebGLRenderer.prototype.renderStrip=function(strip){var gl=this.gl,shaderProgram=this.shaderProgram,mat4Real=PIXI.mat3.toMat4(strip.worldTransform);PIXI.mat4.transpose(mat4Real),PIXI.mat4.multiply(this.projectionMatrix,mat4Real,mat4Real),gl.uniformMatrix4fv(this.shaderProgram.mvMatrixUniform,!1,mat4Real),strip.blendMode==PIXI.blendModes.NORMAL?gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA):gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_COLOR),strip.dirty?(strip.dirty=!1,gl.bindBuffer(gl.ARRAY_BUFFER,strip._vertexBuffer),gl.bufferData(gl.ARRAY_BUFFER,strip.verticies,gl.STATIC_DRAW),gl.vertexAttribPointer(shaderProgram.vertexPositionAttribute,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,strip._uvBuffer),gl.bufferData(gl.ARRAY_BUFFER,strip.uvs,gl.STATIC_DRAW),gl.vertexAttribPointer(shaderProgram.textureCoordAttribute,2,gl.FLOAT,!1,0,0),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,strip.texture.baseTexture._glTexture),gl.bindBuffer(gl.ARRAY_BUFFER,strip._colorBuffer),gl.bufferData(gl.ARRAY_BUFFER,strip.colors,gl.STATIC_DRAW),gl.vertexAttribPointer(shaderProgram.colorAttribute,1,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,strip._indexBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,strip.indices,gl.STATIC_DRAW)):(gl.bindBuffer(gl.ARRAY_BUFFER,strip._vertexBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,strip.verticies),gl.vertexAttribPointer(shaderProgram.vertexPositionAttribute,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,strip._uvBuffer),gl.vertexAttribPointer(shaderProgram.textureCoordAttribute,2,gl.FLOAT,!1,0,0),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,strip.texture.baseTexture._glTexture),gl.bindBuffer(gl.ARRAY_BUFFER,strip._colorBuffer),gl.vertexAttribPointer(shaderProgram.colorAttribute,1,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,strip._indexBuffer)),gl.drawElements(gl.TRIANGLE_STRIP,strip.indices.length,gl.UNSIGNED_SHORT,0),gl.uniformMatrix4fv(this.shaderProgram.mvMatrixUniform,!1,this.projectionMatrix)},PIXI.WebGLRenderer.prototype.handleContextLost=function(event){event.preventDefault(),this.contextLost=!0},PIXI.WebGLRenderer.prototype.handleContextRestored=function(){this.gl=this.view.getContext("experimental-webgl",{alpha:!0}),this.initShaders();for(var i=0;PIXI.TextureCache.length>i;i++)this.updateTexture(PIXI.TextureCache[i]);for(var i=0;this.batchs.length>i;i++)this.batchs[i].restoreLostContext(this.gl),this.batchs[i].dirty=!0;PIXI._restoreBatchs(this.gl),this.contextLost=!1},PIXI._batchs=[],PIXI._getBatch=function(gl){return 0==PIXI._batchs.length?new PIXI.WebGLBatch(gl):PIXI._batchs.pop()},PIXI._returnBatch=function(batch){batch.clean(),PIXI._batchs.push(batch)},PIXI._restoreBatchs=function(gl){for(var i=0;PIXI._batchs.length>i;i++)PIXI._batchs[i].restoreLostContext(gl)},PIXI.WebGLBatch=function(gl){this.gl=gl,this.size=0,this.vertexBuffer=gl.createBuffer(),this.indexBuffer=gl.createBuffer(),this.uvBuffer=gl.createBuffer(),this.colorBuffer=gl.createBuffer(),this.blendMode=PIXI.blendModes.NORMAL,this.dynamicSize=1},PIXI.WebGLBatch.constructor=PIXI.WebGLBatch,PIXI.WebGLBatch.prototype.clean=function(){this.verticies=[],this.uvs=[],this.indices=[],this.colors=[],this.dynamicSize=1,this.texture=null,this.last=null,this.size=0,this.head,this.tail},PIXI.WebGLBatch.prototype.restoreLostContext=function(gl){this.gl=gl,this.vertexBuffer=gl.createBuffer(),this.indexBuffer=gl.createBuffer(),this.uvBuffer=gl.createBuffer(),this.colorBuffer=gl.createBuffer()},PIXI.WebGLBatch.prototype.init=function(sprite){sprite.batch=this,this.dirty=!0,this.blendMode=sprite.blendMode,this.texture=sprite.texture.baseTexture,this.head=sprite,this.tail=sprite,this.size=1,this.growBatch()},PIXI.WebGLBatch.prototype.insertBefore=function(sprite,nextSprite){this.size++,sprite.batch=this,this.dirty=!0;var tempPrev=nextSprite.__prev;nextSprite.__prev=sprite,sprite.__next=nextSprite,tempPrev?(sprite.__prev=tempPrev,tempPrev.__next=sprite):this.head=sprite},PIXI.WebGLBatch.prototype.insertAfter=function(sprite,previousSprite){this.size++,sprite.batch=this,this.dirty=!0;var tempNext=previousSprite.__next;previousSprite.__next=sprite,sprite.__prev=previousSprite,tempNext?(sprite.__next=tempNext,tempNext.__prev=sprite):this.tail=sprite},PIXI.WebGLBatch.prototype.remove=function(sprite){return this.size--,0==this.size?(sprite.batch=null,sprite.__prev=null,sprite.__next=null,undefined):(sprite.__prev?sprite.__prev.__next=sprite.__next:(this.head=sprite.__next,this.head.__prev=null),sprite.__next?sprite.__next.__prev=sprite.__prev:(this.tail=sprite.__prev,this.tail.__next=null),sprite.batch=null,sprite.__next=null,sprite.__prev=null,this.dirty=!0,undefined)},PIXI.WebGLBatch.prototype.split=function(sprite){this.dirty=!0;var batch=new PIXI.WebGLBatch(this.gl);batch.init(sprite),batch.tail=this.tail,this.tail=sprite.__prev,this.tail.__next=null,sprite.__prev=null;for(var tempSize=0;sprite;)tempSize++,sprite.batch=batch,sprite=sprite.__next;return batch.size=tempSize,this.size-=tempSize,batch},PIXI.WebGLBatch.prototype.merge=function(batch){this.dirty=!0,this.tail.__next=batch.head,batch.head.__prev=this.tail,this.size+=batch.size,this.tail=batch.tail;for(var sprite=batch.head;sprite;)sprite.batch=this,sprite=sprite.__next},PIXI.WebGLBatch.prototype.growBatch=function(){var gl=this.gl;this.dynamicSize=1==this.size?1:1.5*this.size,this.verticies=new Float32Array(8*this.dynamicSize),gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer),gl.bufferData(gl.ARRAY_BUFFER,this.verticies,gl.DYNAMIC_DRAW),this.uvs=new Float32Array(8*this.dynamicSize),gl.bindBuffer(gl.ARRAY_BUFFER,this.uvBuffer),gl.bufferData(gl.ARRAY_BUFFER,this.uvs,gl.DYNAMIC_DRAW),this.dirtyUVS=!0,this.colors=new Float32Array(4*this.dynamicSize),gl.bindBuffer(gl.ARRAY_BUFFER,this.colorBuffer),gl.bufferData(gl.ARRAY_BUFFER,this.colors,gl.DYNAMIC_DRAW),this.dirtyColors=!0,this.indices=new Uint16Array(6*this.dynamicSize);for(var length=this.indices.length/6,i=0;length>i;i++){var index2=6*i,index3=4*i;this.indices[index2+0]=index3+0,this.indices[index2+1]=index3+1,this.indices[index2+2]=index3+2,this.indices[index2+3]=index3+0,this.indices[index2+4]=index3+2,this.indices[index2+5]=index3+3}gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this.indices,gl.STATIC_DRAW)},PIXI.WebGLBatch.prototype.refresh=function(){this.gl,this.dynamicSize<this.size&&this.growBatch();for(var index,indexRun=0,displayObject=this.head;displayObject;){index=8*indexRun;var texture=displayObject.texture,frame=texture.frame,tw=texture.baseTexture.width,th=texture.baseTexture.height;this.uvs[index+0]=frame.x/tw,this.uvs[index+1]=frame.y/th,this.uvs[index+2]=(frame.x+frame.width)/tw,this.uvs[index+3]=frame.y/th,this.uvs[index+4]=(frame.x+frame.width)/tw,this.uvs[index+5]=(frame.y+frame.height)/th,this.uvs[index+6]=frame.x/tw,this.uvs[index+7]=(frame.y+frame.height)/th,displayObject.updateFrame=!1,colorIndex=4*indexRun,this.colors[colorIndex]=this.colors[colorIndex+1]=this.colors[colorIndex+2]=this.colors[colorIndex+3]=displayObject.worldAlpha,displayObject=displayObject.__next,indexRun++}this.dirtyUVS=!0,this.dirtyColors=!0},PIXI.WebGLBatch.prototype.update=function(){this.gl;for(var worldTransform,width,height,aX,aY,w0,w1,h0,h1,index,a,b,c,d,tx,ty,indexRun=0,displayObject=this.head;displayObject;){if(width=displayObject.width,height=displayObject.height,aX=displayObject.anchor.x-displayObject.texture.trim.x,aY=displayObject.anchor.y-displayObject.texture.trim.y,w0=width*(1-aX),w1=width*-aX,h0=height*(1-aY),h1=height*-aY,index=8*indexRun,worldTransform=displayObject.worldTransform,a=worldTransform[0],b=worldTransform[3],c=worldTransform[1],d=worldTransform[4],tx=worldTransform[2],ty=worldTransform[5],this.verticies[index+0]=a*w1+c*h1+tx,this.verticies[index+1]=d*h1+b*w1+ty,this.verticies[index+2]=a*w0+c*h1+tx,this.verticies[index+3]=d*h1+b*w0+ty,this.verticies[index+4]=a*w0+c*h0+tx,this.verticies[index+5]=d*h0+b*w0+ty,this.verticies[index+6]=a*w1+c*h0+tx,this.verticies[index+7]=d*h0+b*w1+ty,displayObject.updateFrame){this.dirtyUVS=!0;var texture=displayObject.texture,frame=texture.frame,tw=texture.baseTexture.width,th=texture.baseTexture.height;this.uvs[index+0]=frame.x/tw,this.uvs[index+1]=frame.y/th,this.uvs[index+2]=(frame.x+frame.width)/tw,this.uvs[index+3]=frame.y/th,this.uvs[index+4]=(frame.x+frame.width)/tw,this.uvs[index+5]=(frame.y+frame.height)/th,this.uvs[index+6]=frame.x/tw,this.uvs[index+7]=(frame.y+frame.height)/th,displayObject.updateFrame=!1}if(displayObject.cacheAlpha!=displayObject.worldAlpha){displayObject.cacheAlpha=displayObject.worldAlpha;var colorIndex=4*indexRun;this.colors[colorIndex]=this.colors[colorIndex+1]=this.colors[colorIndex+2]=this.colors[colorIndex+3]=displayObject.worldAlpha,this.dirtyColors=!0}indexRun++,displayObject=displayObject.__next}},PIXI.WebGLBatch.prototype.render=function(){if(this.dirty&&(this.refresh(),this.dirty=!1),0!=this.size){this.update();var gl=this.gl;this.blendMode==PIXI.blendModes.NORMAL?gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA):gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_COLOR);var shaderProgram=PIXI.shaderProgram;gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,this.verticies),gl.vertexAttribPointer(shaderProgram.vertexPositionAttribute,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,this.uvBuffer),this.dirtyUVS&&(this.dirtyUVS=!1,gl.bufferSubData(gl.ARRAY_BUFFER,0,this.uvs)),gl.vertexAttribPointer(shaderProgram.textureCoordAttribute,2,gl.FLOAT,!1,0,0),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,this.texture._glTexture),gl.bindBuffer(gl.ARRAY_BUFFER,this.colorBuffer),this.dirtyColors&&(this.dirtyColors=!1,gl.bufferSubData(gl.ARRAY_BUFFER,0,this.colors)),gl.vertexAttribPointer(shaderProgram.colorAttribute,1,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer),gl.drawElements(gl.TRIANGLES,6*this.size,gl.UNSIGNED_SHORT,0)}},PIXI.CanvasRenderer=function(width,height,view,transparent){this.transparent=transparent,this.width=width||800,this.height=height||600,this.refresh=!0,this.view=view||document.createElement("canvas"),this.view.width=this.width,this.view.height=this.height,this.count=0,this.context=this.view.getContext("2d")},PIXI.CanvasRenderer.constructor=PIXI.CanvasRenderer,PIXI.CanvasRenderer.prototype.render=function(stage){stage.__childrenAdded=[],stage.__childrenRemoved=[],PIXI.texturesToUpdate=[],this.context.setTransform(1,0,0,1,0,0),stage.updateTransform(),this.context.setTransform(1,0,0,1,0,0),this.view.style.backgroundColor==stage.backgroundColorString||this.transparent||(this.view.style.backgroundColor=stage.backgroundColorString),this.context.clearRect(0,0,this.width,this.height),this.renderDisplayObject(stage),stage.interactive&&(stage._interactiveEventsAdded||(stage._interactiveEventsAdded=!0,stage.interactionManager.setTarget(this)))},PIXI.CanvasRenderer.prototype.resize=function(width,height){this.width=width,this.height=height,this.view.width=width,this.view.height=height},PIXI.CanvasRenderer.prototype.renderDisplayObject=function(displayObject){var transform=displayObject.worldTransform,context=this.context;context.globalCompositeOperation="source-over";var blit=!1;if(displayObject.visible){if(displayObject instanceof PIXI.Sprite){var frame=displayObject.texture.frame;frame&&(context.globalAlpha=displayObject.worldAlpha,blit=!1,context.setTransform(transform[0],transform[3],transform[1],transform[4],transform[2],transform[5]),context.drawImage(displayObject.texture.baseTexture.source,frame.x,frame.y,frame.width,frame.height,(displayObject.anchor.x-displayObject.texture.trim.x)*-frame.width,(displayObject.anchor.y-displayObject.texture.trim.y)*-frame.height,displayObject.width,displayObject.height))}else displayObject instanceof PIXI.Strip&&(context.setTransform(transform[0],transform[3],transform[1],transform[4],transform[2],transform[5]),this.renderStrip(displayObject));for(var i=0;displayObject.children.length>i;i++)this.renderDisplayObject(displayObject.children[i])}},PIXI.CanvasRenderer.prototype.renderStripFlat=function(strip){var context=this.context,verticies=strip.verticies;strip.uvs;var length=verticies.length/2;this.count++,context.beginPath();for(var i=1;length-2>i;i++){var index=2*i,x0=verticies[index],x1=verticies[index+2],x2=verticies[index+4],y0=verticies[index+1],y1=verticies[index+3],y2=verticies[index+5];context.moveTo(x0,y0),context.lineTo(x1,y1),context.lineTo(x2,y2)}context.fillStyle="#FF0000",context.fill(),context.closePath()},PIXI.CanvasRenderer.prototype.renderStrip=function(strip){var context=this.context,verticies=strip.verticies,uvs=strip.uvs,length=verticies.length/2;this.count++;for(var i=1;length-2>i;i++){var index=2*i,x0=verticies[index],x1=verticies[index+2],x2=verticies[index+4],y0=verticies[index+1],y1=verticies[index+3],y2=verticies[index+5],u0=uvs[index]*strip.texture.width,u1=uvs[index+2]*strip.texture.width,u2=uvs[index+4]*strip.texture.width,v0=uvs[index+1]*strip.texture.height,v1=uvs[index+3]*strip.texture.height,v2=uvs[index+5]*strip.texture.height;context.save(),context.beginPath(),context.moveTo(x0,y0),context.lineTo(x1,y1),context.lineTo(x2,y2),context.closePath(),context.clip();var delta=u0*v1+v0*u2+u1*v2-v1*u2-v0*u1-u0*v2,delta_a=x0*v1+v0*x2+x1*v2-v1*x2-v0*x1-x0*v2,delta_b=u0*x1+x0*u2+u1*x2-x1*u2-x0*u1-u0*x2,delta_c=u0*v1*x2+v0*x1*u2+x0*u1*v2-x0*v1*u2-v0*u1*x2-u0*x1*v2,delta_d=y0*v1+v0*y2+y1*v2-v1*y2-v0*y1-y0*v2,delta_e=u0*y1+y0*u2+u1*y2-y1*u2-y0*u1-u0*y2,delta_f=u0*v1*y2+v0*y1*u2+y0*u1*v2-y0*v1*u2-v0*u1*y2-u0*y1*v2;context.transform(delta_a/delta,delta_d/delta,delta_b/delta,delta_e/delta,delta_c/delta,delta_f/delta),context.drawImage(strip.texture.baseTexture.source,0,0),context.restore()}},PIXI.Strip=function(texture,width,height){PIXI.DisplayObjectContainer.call(this),this.texture=texture,this.blendMode=PIXI.blendModes.NORMAL;try{this.uvs=new Float32Array([0,1,1,1,1,0,0,1]),this.verticies=new Float32Array([0,0,0,0,0,0,0,0,0]),this.colors=new Float32Array([1,1,1,1]),this.indices=new Uint16Array([0,1,2,3])}catch(error){this.uvs=[0,1,1,1,1,0,0,1],this.verticies=[0,0,0,0,0,0,0,0,0],this.colors=[1,1,1,1],this.indices=[0,1,2,3]}this.width=width,this.height=height,texture.baseTexture.hasLoaded?(this.width=this.texture.frame.width,this.height=this.texture.frame.height,this.updateFrame=!0):(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},PIXI.Strip.constructor=PIXI.Strip,PIXI.Strip.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),PIXI.Strip.prototype.setTexture=function(texture){this.texture=texture,this.width=texture.frame.width,this.height=texture.frame.height,this.updateFrame=!0},PIXI.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},PIXI.Rope=function(texture,points){PIXI.Strip.call(this,texture),this.points=points;try{this.verticies=new Float32Array(4*points.length),this.uvs=new Float32Array(4*points.length),this.colors=new Float32Array(2*points.length),this.indices=new Uint16Array(2*points.length)}catch(error){this.verticies=verticies,this.uvs=uvs,this.colors=colors,this.indices=indices}this.refresh()},PIXI.Rope.constructor=PIXI.Rope,PIXI.Rope.prototype=Object.create(PIXI.Strip.prototype),PIXI.Rope.prototype.refresh=function(){var points=this.points;if(!(1>points.length)){var uvs=this.uvs,indices=this.indices,colors=this.colors,lastPoint=points[0],point=points[0];this.count-=.2,uvs[0]=0,uvs[1]=1,uvs[2]=0,uvs[3]=1,colors[0]=1,colors[1]=1,indices[0]=0,indices[1]=1;for(var total=points.length,i=1;total>i;i++){var point=points[i],index=4*i,amount=i/(total-1);i%2?(uvs[index]=amount,uvs[index+1]=0,uvs[index+2]=amount,uvs[index+3]=1):(uvs[index]=amount,uvs[index+1]=0,uvs[index+2]=amount,uvs[index+3]=1),index=2*i,colors[index]=1,colors[index+1]=1,index=2*i,indices[index]=index,indices[index+1]=index+1,lastPoint=point}}},PIXI.Rope.prototype.updateTransform=function(){var points=this.points;if(!(1>points.length)){var nextPoint,verticies=this.verticies,lastPoint=points[0],perp={x:0,y:0},point=points[0];this.count-=.2,verticies[0]=point.x+perp.x,verticies[1]=point.y+perp.y,verticies[2]=point.x-perp.x,verticies[3]=point.y-perp.y;for(var total=points.length,i=1;total>i;i++){var point=points[i],index=4*i;nextPoint=points.length-1>i?points[i+1]:point,perp.y=-(nextPoint.x-lastPoint.x),perp.x=nextPoint.y-lastPoint.y;var ratio=10*(1-i/(total-1));ratio>1&&(ratio=1);var perpLength=Math.sqrt(perp.x*perp.x+perp.y*perp.y),num=this.texture.height/2;perp.x/=perpLength,perp.y/=perpLength,perp.x*=num,perp.y*=num,verticies[index]=point.x+perp.x,verticies[index+1]=point.y+perp.y,verticies[index+2]=point.x-perp.x,verticies[index+3]=point.y-perp.y,lastPoint=point}PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)}},PIXI.Rope.prototype.setTexture=function(texture){this.texture=texture,this.updateFrame=!0},PIXI.BaseTextureCache={},PIXI.texturesToUpdate=[],PIXI.BaseTexture=function(source){if(PIXI.EventTarget.call(this),this.width=100,this.height=100,this.source=source,this.source instanceof Image)if(this.source.complete)this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,PIXI.texturesToUpdate.push(this);else{var scope=this;this.source.onload=function(){scope.hasLoaded=!0,scope.width=scope.source.width,scope.height=scope.source.height,PIXI.texturesToUpdate.push(scope),scope.dispatchEvent({type:"loaded",content:scope})}}else this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,PIXI.texturesToUpdate.push(this)},PIXI.BaseTexture.constructor=PIXI.BaseTexture,PIXI.BaseTexture.prototype.fromImage=function(){},PIXI.TextureCache={},PIXI.FrameCache={},PIXI.Texture=function(baseTexture,frame){if(PIXI.EventTarget.call(this),frame||(this.noFrame=!0,frame=new PIXI.Rectangle(0,0,1,1)),this.trim=new PIXI.Point,this.baseTexture=baseTexture,this.frame=frame,this.scope=this,baseTexture.hasLoaded)this.noFrame&&(frame=new PIXI.Rectangle(0,0,baseTexture.width,baseTexture.height)),this.setFrame(frame);else{var scope=this;baseTexture.addEventListener("loaded",function(){scope.onBaseTextureLoaded()})}},PIXI.Texture.constructor=PIXI.Texture,PIXI.Texture.prototype.onBaseTextureLoaded=function(){var baseTexture=this.baseTexture;baseTexture.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new PIXI.Rectangle(0,0,baseTexture.width,baseTexture.height)),this.noFrame=!1,this.width=this.frame.width,this.height=this.frame.height,this.scope.dispatchEvent({type:"update",content:this})},PIXI.Texture.prototype.setFrame=function(frame){if(this.frame=frame,this.width=frame.width,this.height=frame.height,frame.x+frame.width>this.baseTexture.width||frame.y+frame.height>this.baseTexture.height)throw Error("Texture Error: frame does not fit inside the base Texture dimensions "+this)},PIXI.Texture.fromImage=function(imageUrl,crossorigin){var texture=PIXI.TextureCache[imageUrl];if(!texture){var baseTexture=PIXI.BaseTextureCache[imageUrl];if(!baseTexture){var image=new Image;crossorigin&&(image.crossOrigin=""),image.src=imageUrl,baseTexture=new PIXI.BaseTexture(image),PIXI.BaseTextureCache[imageUrl]=baseTexture}texture=new PIXI.Texture(baseTexture),PIXI.TextureCache[imageUrl]=texture}return texture},PIXI.Texture.fromFrame=function(frameId){var texture=PIXI.TextureCache[frameId];if(!texture)throw Error("The frameId '"+frameId+"' does not exist in the texture cache "+this);return texture},PIXI.Texture.fromCanvas=function(canvas){var baseTexture=new PIXI.BaseTexture(canvas);return new PIXI.Texture(baseTexture)},PIXI.Texture.addTextureToCache=function(texture,id){PIXI.TextureCache[id]=texture},PIXI.Texture.removeTextureFromCache=function(id){var texture=PIXI.TextureCache[id];return PIXI.TextureCache[id]=null,texture},PIXI.SpriteSheetLoader=function(url){PIXI.EventTarget.call(this),this.url=url,this.baseUrl=url.replace(/[^\/]*$/,""),this.texture,this.frames={},this.crossorigin=!1},PIXI.SpriteSheetLoader.constructor=PIXI.SpriteSheetLoader,PIXI.SpriteSheetLoader.prototype.load=function(){this.ajaxRequest=new AjaxRequest;var scope=this;this.ajaxRequest.onreadystatechange=function(){scope.onLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},PIXI.SpriteSheetLoader.prototype.onLoaded=function(){if(4==this.ajaxRequest.readyState&&(200==this.ajaxRequest.status||-1==window.location.href.indexOf("http"))){var jsondata=eval("("+this.ajaxRequest.responseText+")"),textureUrl=this.baseUrl+jsondata.meta.image;this.texture=PIXI.Texture.fromImage(textureUrl,this.crossorigin).baseTexture;var frameData=jsondata.frames;for(var i in frameData){var rect=frameData[i].frame;rect&&(PIXI.TextureCache[i]=new PIXI.Texture(this.texture,{x:rect.x,y:rect.y,width:rect.w,height:rect.h}),frameData[i].trimmed&&(PIXI.TextureCache[i].realSize=frameData[i].spriteSourceSize,PIXI.TextureCache[i].trim.x=0))}if(this.texture.hasLoaded)this.dispatchEvent({type:"loaded",content:this});else{var scope=this;this.texture.addEventListener("loaded",function(){scope.dispatchEvent({type:"loaded",content:scope})})}}},PIXI.AssetLoader=function(assetURLs){PIXI.EventTarget.call(this),this.assetURLs=assetURLs,this.assets=[],this.crossorigin=!1},PIXI.AssetLoader.constructor=PIXI.AssetLoader,PIXI.AssetLoader.prototype.load=function(){this.loadCount=this.assetURLs.length;for(var imageTypes=["jpeg","jpg","png","gif"],spriteSheetTypes=["json"],i=0;this.assetURLs.length>i;i++){for(var filename=this.assetURLs[i],fileType=filename.split(".").pop().toLowerCase(),type=null,j=0;imageTypes.length>j;j++)if(fileType==imageTypes[j]){type="img";
break}if("img"!=type)for(var j=0;spriteSheetTypes.length>j;j++)if(fileType==spriteSheetTypes[j]){type="atlas";break}if("img"==type){var texture=PIXI.Texture.fromImage(filename,this.crossorigin);if(texture.baseTexture.hasLoaded)this.loadCount--,0==this.loadCount&&(this.dispatchEvent({type:"onComplete",content:this}),this.onComplete&&this.onComplete());else{var scope=this;texture.baseTexture.addEventListener("loaded",function(){scope.onAssetLoaded()}),this.assets.push(texture)}}else{if("atlas"!=type)throw Error(filename+" is an unsupported file type "+this);var spriteSheetLoader=new PIXI.SpriteSheetLoader(filename);spriteSheetLoader.crossorigin=this.crossorigin,this.assets.push(spriteSheetLoader);var scope=this;spriteSheetLoader.addEventListener("loaded",function(){scope.onAssetLoaded()}),spriteSheetLoader.load()}}},PIXI.AssetLoader.prototype.onAssetLoaded=function(){this.loadCount--,this.dispatchEvent({type:"onProgress",content:this}),this.onProgress&&this.onProgress(),0==this.loadCount&&(this.dispatchEvent({type:"onComplete",content:this}),this.onComplete&&this.onComplete())},window.gf=window.gf||{},gf.Point=PIXI.Point,gf.Rectangle=PIXI.Rectangle,gf.Texture=PIXI.Texture,gf.EventTarget=PIXI.EventTarget,gf.version="0.0.2",gf.assetCache={},gf.support={ua:navigator.userAgent.toLowerCase(),canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return!1}}(),workers:!!window.Worker,typedArrays:!!("ArrayBuffer"in window),fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,audio:{play:!!document.createElement("audio").canPlayType,m4a:!1,mp3:!1,ogg:!1,wav:!1},localStorage:!!window.localStorage,touch:"createTouch"in document||"ontouchstart"in window||navigator.isCocoonJS,gamepad:!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||-1!==navigator.userAgent.indexOf("Firefox/")},gf.support.audio.play){var a=document.createElement("audio");gf.support.audio.m4a=!!a.canPlayType('audio/mp4; codecs="mp4a.40.2"').replace(/no/,""),gf.support.audio.mp3=!!a.canPlayType("audio/mpeg").replace(/no/,""),gf.support.audio.ogg=!!a.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,""),gf.support.audio.wav=!!a.canPlayType('audio/wav; codecs="1"').replace(/no/,""),(gf.support.ua.search("iphone")>-1||gf.support.ua.search("ipod")>-1||gf.support.ua.search("ipad")>-1||gf.support.ua.search("android")>-1)&&(navigator.isCocoonJS||(gf.support.audio.play=!1))}gf.checkVersion=function(first,second){second=second||gf.version;for(var a=first.split("."),b=second.split("."),len=Math.min(a.length,b.length),result=0,i=0;len>i&&!(result=+a[i]-+b[i]);++i);return result?result:a.length-b.length},gf.inherits=function(c,p,proto){proto=proto||{};var e={};[c.prototype,proto].forEach(function(s){Object.getOwnPropertyNames(s).forEach(function(k){e[k]=Object.getOwnPropertyDescriptor(s,k)})}),c.prototype=Object.create(p.prototype,e),c["super"]=p},gf.Game=function(contId,settings){var w=settings.width||gf.utils.getStyle(this.container,"width"),h=settings.height||gf.utils.getStyle(this.container,"height");if(this.gravity=.98,this.friction=new gf.Vector(0,0),this.renderMethod="webgl",this.players=[],this.stage=new PIXI.Stage(settings.background||16711935,settings.interactive!==undefined?settings.interactive:!0),this.clock=new gf.Clock(!1),this.renderer=null,settings.renderMethod){if(!gf.support[settings.renderMethod])throw"Render method "+settings.renderMethod+" is not supported by this browser!";this.renderMethod=settings.renderMethod}else if(gf.support.webgl)this.renderMethod="webgl";else{if(!gf.support.canvas)throw"Neither WebGL nor Canvas is supported by this browser!";this.renderMethod="canvas"}"webgl"===this.renderMethod?this.renderer=new PIXI.WebGLRenderer(w,h):"canvas"===this.renderMethod&&(this.renderer=new PIXI.CanvasRenderer(w,h)),this.container=document.getElementById(contId),this.MAX_Z=500,this.loader=new gf.AssetLoader,this.audio=new gf.AudioPlayer(this),this.input=new gf.InputManager(this),this.camera=new gf.Camera(this),this.addObject(this.camera),this.camera.resize(w,h),this.container.appendChild(this.renderer.view),gf.utils.setValues(this,settings)},gf.inherits(gf.Game,Object,{resize:function(w,h){this.renderer.resize(w,h);for(var i=0,il=this.stage.children.length;il>i;++i){var o=this.stage.children[i];o.resize&&o.resize(w,h)}return this},addObject:function(obj){return obj&&(obj instanceof gf.Camera||obj instanceof gf.Map?this.stage.addChildAt(obj,0):obj instanceof gf.Gui?this.camera.addChild(obj):this.world.addChild(obj)),this},removeObject:function(obj){return obj&&(obj instanceof gf.Gui||obj instanceof gf.Hud?this.camera.removeChild(obj):this.world.removeChild(obj)),this},loadWorld:function(world){if("string"==typeof world){if(!gf.assetCache[world])throw"World not found in assetCache!";world=gf.assetCache[world]}return this.world=new gf.TiledMap(this,world),this.addObject(this.world),this.camera.setBounds(0,0,this.world.realSize.x,this.world.realSize.y),this.world.properties.music&&this.audio.play(this.world.properties.music,{loop:"true"===this.world.properties.music_loop}),this},render:function(){return this.clock.start(),this._tick(),this},checkCollisions:function(ent){var colliders=[];if(!ent.collidable)return colliders;for(var i=0,il=this.stage.children;il>i;++i){var o=this.stage.children[i];if(o.visible&&o.collidable&&o.entity&&o!==ent){var collisionVector=o.checkCollision(ent);(0!==collisionVector.x||0!==collisionVector.y)&&(colliders.push({entity:o,vector:collisionVector}),o.onCollision(ent))}}return colliders},_tick:function(){window.requestAnimFrame(this._tick.bind(this)),this._delta=this.clock.getDelta(),gf.debug.update(),this.input.update(),this.camera.update();for(var i=0,il=this.stage.children.length;il>i;++i){var o=this.stage.children[i];o.visible&&o.update&&o.update()}this.renderer.render(this.stage)}}),gf.AssetLoader=function(resources){gf.EventTarget.call(this),this.resources=resources||[],this.loadCount=0,this.assets={},this.exts={imgs:["jpeg","jpg","png","gif"],sound:["mp3","ogg","wma","wav"],data:["json"]}},gf.inherits(gf.AssetLoader,Object,{load:function(items){for(var resources=items||this.resources,i=0,il=resources.length;il>i;++i){var name="string"==typeof resources[i]?resources[i]:resources[i].name,url="string"==typeof resources[i]?resources[i]:resources[i].src,ext=url.split(".").pop().toLowerCase();-1!==this.exts.imgs.indexOf(ext)?this.loadTexture(name,url):-1!==this.exts.sound.indexOf(ext)?this.loadAudio(name,url):-1!==this.exts.data.indexOf(ext)&&this.loadData(name,url)}},loadTexture:function(name,url){this.loadCount++;var self=this,texture=gf.Texture.fromImage(url);return this._storeAsset(name,texture),texture.baseTexture.hasLoaded?self.onAssetLoaded(null,"texture",texture):texture.baseTexture.on("loaded",function(){self.onAssetLoaded(null,"texture",texture)}),texture},loadAudio:function(name,url){this.loadCount++;var self=this,audio=new Audio(url);return audio.preload="auto",this._storeAsset(name,audio),audio.addEventListener("canplaythrough",function(){self.onAssetLoaded(null,"audio",audio)},!1),audio.addEventListener("error",function(){self.onAssetLoaded(Error('Failed to load audio "'+name+'" at url: '+url),"audio")},!1),audio.load(),audio},loadData:function(name,url){this.loadCount++;var self=this,baseUrl=url.replace(/[^\/]*$/,"");gf.utils.ajax({method:"GET",url:url,dataType:"json",load:function(data){if(data.orientation&&data.layers&&data.tilesets&&data.version){self._storeAsset(name,data);for(var i=0,il=data.layers.length;il>i;++i){var layer=data.layers[i];if("objectgroup"===layer.type)for(var o=0,ol=layer.objects.length;ol>o;++o){var obj=layer.objects[o];obj.properties.spritesheet&&self.loadTexture(layer.name+"_"+obj.name+"_texture",obj.properties.spritesheet)}}for(var s=0,sl=data.tilesets.length;sl>s;++s){var set=data.tilesets[s];set.image&&self.loadTexture(set.name+"_texture",baseUrl+set.image)}self.onAssetLoaded(null,"world",data)}else if(data.frames&&data.meta){var textureUrl=baseUrl+data.meta.image,texture=gf.Texture.fromImage(textureUrl).baseTexture,frames=data.frames,assets={};for(var f in frames){var rect=frames[f].frame;PIXI.TextureCache[f]=new gf.Texture(texture,{x:rect.x,y:rect.y,width:rect.w,height:rect.h}),frames[f].trimmed&&(PIXI.TextureCache[f].realSize=frames[f].spriteSourceSize,PIXI.TextureCache[f].trim.x=0),assets[f]=PIXI.TextureCache[f]}self._storeAsset(name,assets),texture.hasLoaded?self.onAssetLoaded(null,"spritesheet",assets):texture.addEventListener("loaded",function(){self.onAssetLoaded(null,"spritesheet",assets)})}},error:function(err){self.onAssetLoaded(err)}})},onAssetLoaded:function(err,type,asset){this.loadCount--,this.emit({type:"progress",error:err,assetType:type,asset:asset}),this.onProgress&&this.onProgress(err,type,asset),0===this.loadCount&&(this.dispatchEvent({type:"complete"}),this.onComplete&&this.onComplete())},_storeAsset:function(name,asset){this.assets[name]=asset,gf.assetCache[name]=asset}}),gf.AudioPlayer=function(game){this.game=game,this.playing={},this.resetTime=0},gf.inherits(gf.AudioPlayer,Object,{_getOpen:function(id){for(var chans=this.playing[id],i=0,il=chans.length;il>i;++i){var clip=chans[i++];if(clip.ended||!clip.currentTime)return clip.currentTime=this.resetTime,clip}var sound=new Audio(chans[0].src);return sound.preload="auto",sound.load(),sound.channel=chans.length,chans.push(sound),chans[chans.length-1]},play:function(id,opts,cb){if(!gf.assetCache[id])throw"Tried to play unloaded audio: "+id;if("function"==typeof opts&&(cb=opts,opts=null),"object"==typeof id&&(opts=id,id=opts.id),opts=opts||{},opts.id=id,opts.loop=opts.loop||!1,opts.volume=opts.volume||1,opts.channel!==undefined&&this.playing[id])return this.playing[id][opts.channel].play(),opts;this.playing[id]||(this.playing[id]=[gf.assetCache[id]],this.playing[id][0].channel=0);var sound=this._getOpen(id);if(sound.loop=opts.loop,sound.volume=opts.volume,sound.play(),opts.channel=sound.channel,!opts.loop){var self=this,ended=function(){sound.removeEventListener("ended",ended,!1),self.stop(opts),cb&&cb()};sound.addEventListener("ended",ended,!1)}return opts},stop:function(id,channel){"object"==typeof id&&(channel=id.channel,id=id.id),this.playing[id]&&this.playing[id][channel]&&(this.playing[id][channel].pause(),this.playing[id][channel].currentTime=this.resetTime,this.playing[id][channel].ended=!0)},pause:function(id,channel){"object"==typeof id&&(channel=id.channel,id=id.id),this.playing[id]&&this.playing[id][channel]&&this.playing[id][channel].pause()},playAll:function(){for(var sid in this.playing)for(var chans=this.playing[sid],i=0,il=chans.length;il>i;++i)this.play({id:sid,channel:i})},stopAll:function(){for(var sid in this.playing)for(var chans=this.playing[sid],i=0,il=chans.length;il>i;++i)this.stop(sid,i)},pauseAll:function(){for(var sid in this.playing)for(var chans=this.playing[sid],i=0,il=chans.length;il>i;++i)this.pause(sid,i)}}),gf.DisplayObject=function(){PIXI.DisplayObjectContainer.call(this)},gf.inherits(gf.DisplayObject,PIXI.DisplayObjectContainer,{update:function(){for(var i=0,il=this.children.length;il>i;++i){var o=this.children[i];o.visible&&o.update&&o.update()}},resize:function(){for(var i=0,il=this.children.length;il>i;++i){var o=this.children[i];o.visible&&o.resize&&o.resize()}},removeAllChildren:function(){for(var i=0,il=this.children.length;il>i;++i)this.stage&&this.stage.__removeChild(this.children[i]);this.children=[]}}),gf.Camera=function(game,settings){this.game=game,this._bounds=new PIXI.Rectangle(0,0,0,0),this._deadzone=null,this._target=null,this.size=new gf.Vector(0,0),this.hSize=new gf.Vector(0,0),this._fx={flash:{alpha:0,complete:null},fade:{alpha:0,complete:null},shake:{intensity:0,duration:0,direction:gf.Camera.SHAKE.BOTH,offset:new gf.Point(0,0),previous:new gf.Point(0,0),complete:null}},gf.DisplayObject.call(this,settings),gf.utils.setValues(this,settings)},gf.inherits(gf.Camera,gf.DisplayObject,{flash:function(color,duration,cb){return this._fx.flash.alpha>0?this:("function"==typeof duration&&(cb=duration,duration=1),"function"==typeof color&&(cb=color,duration=1,color=16777215),duration=duration||1,0>duration&&(duration=1),color===undefined&&(color=16777215),this._fx.flash.color=color,this._fx.flash.duration=duration,this._fx.flash.alpha=1,this._fx.flash.complete=cb,this)},stopFlash:function(){return this._fx.flash.alpha=0,this},fade:function(color,duration,cb){return this._fx.fade.alpha>0?this:("function"==typeof duration&&(cb=duration,duration=1),"function"==typeof color&&(cb=color,duration=1,color=16777215),duration=duration||1,0>duration&&(duration=1),color===undefined&&(color=16777215),this._fx.fade.color=color,this._fx.fade.duration=duration,this._fx.fade.alpha=.01,this._fx.fade.complete=cb,this)},stopFade:function(){return this._fx.fade.alpha=0,this},shake:function(intensity,duration,direction,cb){return 0!==this._fx.shake.offset.x||0!==this._fx.shake.offset.y?this:("function"==typeof direction&&(cb=direction,direction=gf.Camera.SHAKE.BOTH),"function"==typeof duration&&(cb=duration,direction=gf.Camera.SHAKE.BOTH,duration=null),"function"==typeof intensity&&(cb=intensity,direction=gf.Camera.SHAKE.BOTH,duration=null,intensity=null),intensity=intensity||.01,duration=duration||1e3,direction=direction||gf.Camera.SHAKE.BOTH,this._fx.shake.intensity=intensity,this._fx.shake.duration=duration,this._fx.shake.direction=direction,this._fx.shake.offset.x=0,this._fx.shake.offset.y=0,this._fx.shake.previous.x=this.game.world.position.x,this._fx.shake.previous.y=this.game.world.position.y,this._fx.shake.complete=cb,this)},stopShake:function(){return 0!==this._fx.shake.duration&&(this._fx.shake.duration=0,this._fx.shake.offset.x=0,this._fx.shake.offset.y=0,this.focus(this._fx.shake.previous)),this},stopAll:function(){return this.stopFlash(),this.stopFade(),this.stopShake(),this},follow:function(ent,style){if(!(ent instanceof gf.Entity))return this;switch(this._target=ent,style){case gf.Camera.FOLLOW.PLATFORMER:var w=this.size.x/8,h=this.size.y/3;this._deadzone=new PIXI.Rectangle((this.size.x-w)/2,(this.size.y-h)/2-h/4,w,h);break;case gf.Camera.FOLLOW.TOPDOWN:var sq4=Math.max(this.size.x,this.size.y)/4;this._deadzone=new PIXI.Rectangle((this.size.x-sq4)/2,(this.size.y-sq4)/2,sq4,sq4);break;case gf.Camera.FOLLOW.TOPDOWN_TIGHT:var sq8=Math.max(this.size.x,this.size.y)/8;this._deadzone=new PIXI.Rectangle((this.size.x-sq8)/2,(this.size.y-sq8)/2,sq8,sq8);break;case gf.Camera.FOLLOW.LOCKON:default:this._deadzone=null}return this.focusEntity(this._target),this},unfollow:function(){return this._target=null,this},focus:function(x,y){y=x instanceof gf.Point?x.y:y||0,x=x instanceof gf.Point?x.x:x||0;var goToX=x-this.hSize.x,goToY=y-this.hSize.y,dx=goToX+this.game.world.position.x,dy=goToY+this.game.world.position.y;return this.pan(dx,dy)},focusEntity:function(ent){this.focus(ent.viewPosition.x*this.game.world.scale.x,ent.viewPosition.y*this.game.world.scale.y)},pan:function(dx,dy){if(dy=dx instanceof gf.Point?dx.y:dy||0,dx=dx instanceof gf.Point?dx.x:dx||0,dx||dy){var newX=this.game.world.position.x-dx,newY=this.game.world.position.y-dy;return newX>0?dx=0+this.game.world.position.x:-this._bounds.maxPanX>newX&&(dx=this._bounds.maxPanX+this.game.world.position.x),newY>0?dy=0-Math.abs(this.game.world.position.y):-this._bounds.maxPanY>newY&&(dy=this._bounds.maxPanY+this.game.world.position.y),(dx||dy)&&this.game.world.pan(-dx,-dy),this}},resize:function(w,h){return this.size.set(w,h),this.hSize.set(Math.round(this.size.x/2),Math.round(this.size.y/2)),this},setBounds:function(x,y,width,height){return this._bounds.x=x,this._bounds.y=y,this._bounds.width=width,this._bounds.height=height,this._bounds.maxX=this._bounds.x+this._bounds.width,this._bounds.maxY=this._bounds.y+this._bounds.height,this._bounds.maxPanX=width-this.size.x,this._bounds.maxPanY=height-this.size.y,this},update:function(){if(gf.DisplayObject.prototype.update.call(this),this._target)if(this._deadzone){var moveX,moveY,dx,dy,camX=(this._target.position.x+this.game.world.position.x/this.game.world.scale.x)*this.game.world.scale.x,camY=(this._target.position.y+this.game.world.position.y/this.game.world.scale.y)*this.game.world.scale.x;moveX=moveY=dx=dy=0,dx=camX-this._deadzone.x,dy=camY-this._deadzone.y,0>dx&&(moveX=dx),0>dy&&(moveY=dy),dx=camX-(this._deadzone.x+this._deadzone.width),dy=camY-(this._deadzone.y+this._deadzone.height),dx>0&&(moveX=dx),dy>0&&(moveY=dy),this.pan(Math.round(moveX),Math.round(moveY))}else this.focusEntity(this._target);return this._fx.flash.alpha>0&&(this._fx.flash.alpha-=1e3*this.game._delta/this._fx.flash.duration,0>=this._fx.flash.alpha&&(this._fx.flash.alpha=0,this._fx.flash.complete&&this._fx.flash.complete())),this._fx.fade.alpha>0&&(this._fx.fade.alpha+=1e3*this.game._delta/this._fx.fade.duration,this._fx.fade.alpha>=1&&(this._fx.fade.alpha=1,this._fx.fade.complete&&this._fx.fade.complete())),this._fx.shake.duration>0&&(this._fx.shake.duration-=1e3*this.game._delta,0>=this._fx.shake.duration?(this._fx.shake.duration=0,this._fx.shake.offset.x=0,this._fx.shake.offset.y=0,this.focus(this._fx.shake.previous),this._fx.shake.complete&&this._fx.shake.complete()):((this._fx.shake.direction===gf.Camera.SHAKE.BOTH||this._fx.shake.direction===gf.Camera.SHAKE.HORIZONTAL)&&(this._fx.shake.offset.x=2*Math.random()*this._fx.shake.intensity*this.size.x-this._fx.shake.intensity*this.size.x),(this._fx.shake.direction===gf.Camera.SHAKE.BOTH||this._fx.shake.direction===gf.Camera.SHAKE.VERTICAL)&&(this._fx.shake.offset.y=2*Math.random()*this._fx.shake.intensity*this.size.y-this._fx.shake.intensity*this.size.y)),this.pan(this._fx.shake.offset)),this}}),gf.Camera.FOLLOW={PLATFORMER:0,TOPDOWN:1,TOPDOWN_TIGHT:2,LOCKON:3},gf.Camera.SHAKE={BOTH:0,HORIZONTAL:1,VERTICAL:2},gf.Sprite=function(pos,settings){if(this.size=new gf.Vector(0,0),this.name="",this.anim={},this.currentAnim=null,this.interactive=!1,gf.DisplayObject.call(this),gf.utils.setValues(this,settings),this.position.x=pos.x||pos[0]||parseInt(pos,10)||0,this.position.y=pos.y||pos[1]||parseInt(pos,10)||0,settings.animations)for(var name in settings.animations)this.addAnimation(name,settings.animations[name]);if(settings.texture){if("string"==typeof settings.texture)if(gf.assetCache[settings.texture])settings.texture=gf.assetCache[settings.texture];else{var loader=new gf.AssetLoader;settings.texture=loader.loadTexture(settings.texture,settings.texture)}if(settings.texture instanceof gf.Texture){var spr=new PIXI.Sprite(settings.texture);settings.interactive&&spr.setInteractive(!0),this.addChild(spr),this.anim["default"]=spr}}},gf.inherits(gf.Sprite,gf.DisplayObject,{addAnimation:function(name,frames,speed){if(!frames)throw"No textures passed to addAnimation()";if(frames instanceof Array)for(var i=0,il=frames.length;il>i;++i)if("string"==typeof frames[i]){if(!PIXI.TextureCache[frames[i]])throw"Texture "+frames[i]+" is not in cache, please load it first";frames[i]=PIXI.TextureCache[frames[i]]}if(frames instanceof gf.Texture&&(frames=[frames]),"string"==typeof frames){if(!PIXI.TextureCache[frames])throw"Texture "+frames+" is not in cache, please load it first";frames=[PIXI.TextureCache[frames]]}var clip=new PIXI.MovieClip(frames);return clip.stop(),clip.visible=!1,clip.name=name,this.interactive&&clip.setInteractive(this.interactive),speed&&(clip.animationSpeed=speed),this.addChild(clip),this.anim[name]=clip.childIndex,this},setActiveAnimation:function(name,loop,cb){if("function"==typeof loop&&(cb=loop,loop=!1),this.anim[name]===undefined)throw"Unknown animation "+name;return this.currentAnim&&(this.currentAnim.stop(),this.currentAnim.visible=!1),this.currentAnim=this.children[this.anim[name]],this.currentAnim.visible=!0,this.currentAnim.loop=loop,this.currentAnim.onComplete=cb,this.currentAnim.gotoAndPlay(0),this},setPosition:function(x,y){return x instanceof gf.Vector||x instanceof gf.Point?(this.position.x=x.x,this.position.y=x.y):x instanceof Array?(this.position.x=x[0],this.position.y=x[1]):(this.position.x=x,this.position.y=y),this},isActiveAnimation:function(name){return this.currentAnim.name===name},setInteractive:function(interactive){this.interactive=interactive;for(var i=0,il=this.children.length;il>i;++i)this.children[i].setInteractive&&this.children[i].setInteractive(interactive)}}),["stop","play","gotoAndStop","gotoAndPlay"].forEach(function(fn){gf.Sprite.prototype[fn]=function(){this.currentAnim&&this.currentAnim[fn]&&this.currentAnim[fn].apply(this.currentAnim,arguments)}}),gf.Entity=function(game,pos,settings){this.game=game,this.type=gf.Entity.TYPE.NEUTRAL,this.collidable=!0,this.mapCollidable=!0,this.entity=!0,this.velocity=new gf.Vector(0,0),this.maxVelocity=new gf.Vector(15,15),this.accel=new gf.Vector(250,250),this.friction=0,this.gravity=0,this.alive=!0,this.falling=!1,this.jumping=!1,this.onladder=!1,this.viewPosition=new gf.Point(0,0),gf.Sprite.call(this,pos,settings),this.viewPosition.x=Math.round(this.position.x),this.viewPosition.y=Math.round(this.position.y)},gf.inherits(gf.Entity,gf.Sprite,{distanceTo:function(obj){if(!obj||!obj.position)return-1;var dx=this.position.x-obj.position.x,dy=this.position.y-obj.position.y;return Math.sqrt(dx*dx+dy*dy)},computeVelocity:function(vel){return this.gravity&&(vel.y-=this.onladder?0:this.gravity*this.game._delta,this.falling=0>vel.y,this.jumping=this.falling?!1:this.jumping),this.friction.x&&(vel.x=this.applyFriction(vel.x,this.friction.x)),this.friction.y&&(vel.y=this.applyFriction(vel.y,this.friction.y)),vel.x&&(vel.x=gf.utils.clamp(vel.x,-this.maxVelocity.x,this.maxVelocity.x)),vel.y&&(vel.y=gf.utils.clamp(vel.y,-this.maxVelocity.y,this.maxVelocity.y)),vel},applyFriction:function(vel,friction){return 0>vel+friction?vel+friction*(this.game._delta||0):vel-friction>0?vel-friction*(this.game._delta||0):0},intersects:function(obj){return 2*Math.abs(this.position.x-obj.position.x)<this.size.x+obj.size.x&&2*Math.abs(this.position.y-obj.position.y)<this.size.y+obj.size.y},checkCollision:function(obj){var p=new gf.Vector(0,0);if(this.intersects(obj)){var dx=this.position.x-obj.position.x,dy=this.position.y-obj.position.y;p.x=dx/2,p.y=dy/2}return p},updateMovement:function(){if(0!==this.velocity.x||0!==this.velocity.y){this.computeVelocity(this.velocity);var colliders=this.game.world!==undefined&&this.mapCollidable?this.game.world.checkCollision(this,this.velocity):[];this.onladder=!1;for(var i=0,il=colliders.length;il>i;++i){var collider=colliders[i],tile=collider.tile,axis=collider.axis;if(this.onladder=tile.type===gf.Layer.COLLISION.LADDER?!0:this.onladder,tile.type===gf.Layer.COLLISION.SOLID){if(!(!tile.normal||this.velocity.x&&this.velocity.y)){var badMovement=tile.normal.clone().multiplyScalar(this.velocity.dot(tile.normal)),newMovement=this.velocity.clone().sub(badMovement);return this.velocity.add(newMovement),!1}this.velocity[axis]=0}}return this.moveEntity(),colliders}},moveEntity:function(vel){return vel=vel||this.velocity,0!==vel.x||0!==vel.y?(this.position.x+=vel.x,this.position.y+=vel.y,this.viewPosition.x=Math.round(this.position.x),this.viewPosition.y=Math.round(this.position.y),this.onMove(vel),this):undefined},setPosition:function(x,y){return gf.Sprite.prototype.setPosition.call(this,x,y),this.viewPosition.x=Math.round(this.position.x),this.viewPosition.y=Math.round(this.position.y),this},update:function(){gf.Sprite.prototype.update.call(this),this.updateMovement()},onCollision:function(){return this.collidable&&this.type===gf.Entity.TYPE.COLLECTABLE&&this.game.removeObject(this),this},onMove:function(){return this},onBreakTile:function(){return this}}),gf.Entity.TYPE={PLAYER:"player",ENEMY:"enemy",FRIENDLY:"friendly",NEUTRAL:"neutral",COLLECTABLE:"collectable"},gf.entityPool={_objects:{},add:function(name,obj){return gf.entityPool._objects[name]=obj},has:function(name){return!!gf.entityPool._objects[name]},create:function(game,name,props){return name&&gf.entityPool.has(name)?new gf.entityPool._objects[name](game,props.pos||props.position||[props.x,props.y],props):new gf.Entity(game,props.pos||props.position||[props.x,props.y],props)}},gf.debug={fpsStyle:{position:"absolute",top:"0px",left:"0px","z-index":10},showFpsCounter:function(){gf.debug._fpsCounter=new gf.debug.FpsCounter;for(var s in gf.debug.fpsStyle)gf.debug._fpsCounter.domElement.style[s]=gf.debug.fpsStyle[s];document.body.appendChild(gf.debug._fpsCounter.domElement)},showDebugInfo:function(game,pad){gf.debug._info=new gf.debug.Info(game,pad),document.body.appendChild(gf.debug._info.domElement)},update:function(){gf.debug._fpsCounter&&gf.debug._fpsCounter.update(),gf.debug._info&&gf.debug._info.update()},Info:function(game,pad){this.game=game,this.showGamepad=pad!==undefined?pad:!0;var br=document.createElement("br"),container=document.createElement("div");container.id="gf-debug-info",container.style.position="absolute",container.style.top="50px",container.style.left="0",container.style["z-index"]="10",container.style.color="#FFF",container.style["font-size"]="0.9em";var title=document.createElement("h3");title.id="gf-debug-info-title",title.textContent="Debug Info",title.style.cssText="margin:1px;display:block;",container.appendChild(title);var pos=document.createElement("span"),posVal=document.createElement("span");pos.id="gf-debug-info-position",posVal.id="gf-debug-info-position-value",pos.textContent="Player Position: ",posVal.textContent="X: 0, Y: 0";var pads=document.createElement("span");pads.id="gf-debug-info-gamepads",container.appendChild(pads),pos.appendChild(posVal),container.appendChild(pos),container.appendChild(br.cloneNode()),this.player=this.REVISION=1,this.domElement=container,this.update=function(){if(posVal.textContent=this.game.players[0]?"X: "+this.game.players[0].position.x.toFixed(1)+", Y: "+this.game.players[0].position.y.toFixed(1):"none",this.showGamepad&&(pads.innerHTML="",this.game.input.gamepad.pads&&this.game.input.gamepad.pads.length))for(var i=0,il=this.game.input.gamepad.pads.length;il>i;++i){var pad=this.game.input.gamepad.pads[i];pads.innerHTML+="Gamepad: ["+pad.index+"] "+pad.id+"<br/>",pads.innerHTML+="&nbsp;&nbsp;&nbsp;Buttons:<br/>"+pad.buttons.map(function(v,i){return"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+gf.input.getGpButtonName(i)+": "+v.toFixed(2)}).join("<br/>")+"<br/>",pads.innerHTML+="&nbsp;&nbsp;&nbsp;Axes:<br/>"+pad.axes.map(function(v,i){return"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+gf.input.getGpAxisName(i)+": "+v.toFixed(2)}).join("<br/>")+"<br/>"}}},FpsCounter:function(){var l=Date.now(),m=l,g=0,n=1e3,o=0,h=0,p=1e3,q=0,r=0,s=0,f=document.createElement("div");f.id="gf-stats",f.addEventListener("mousedown",function(b){b.preventDefault(),t(++s%2)},!1),f.style.cssText="width:80px;opacity:0.9;cursor:pointer";var a=document.createElement("div");a.id="fps",a.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",f.appendChild(a);var i=document.createElement("div");i.id="fpsText",i.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",i.innerHTML="FPS",a.appendChild(i);var c=document.createElement("div");for(c.id="fpsGraph",c.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",a.appendChild(c);74>c.children.length;){var j=document.createElement("span");j.style.cssText="width:1px;height:30px;float:left;background-color:#113",c.appendChild(j)}var d=document.createElement("div");d.id="ms",d.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",f.appendChild(d);var k=document.createElement("div");k.id="msText",k.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",k.innerHTML="MS",d.appendChild(k);var e=document.createElement("div");for(e.id="msGraph",e.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",d.appendChild(e);74>e.children.length;)j=document.createElement("span"),j.style.cssText="width:1px;height:30px;float:left;background-color:#131",e.appendChild(j);var t=function(b){switch(s=b){case 0:a.style.display="block",d.style.display="none";break;case 1:a.style.display="none",d.style.display="block"}};return{domElement:f,setMode:t,begin:function(){l=Date.now()},end:function(){var b=Date.now();g=b-l,n=Math.min(n,g),o=Math.max(o,g),k.textContent=g+" MS ("+n+"-"+o+")";var a=Math.min(30,30-30*(g/200));return e.appendChild(e.firstChild).style.height=a+"px",r++,b>m+1e3&&(h=Math.round(1e3*r/(b-m)),p=Math.min(p,h),q=Math.max(q,h),i.textContent=h+" FPS ("+p+"-"+q+")",a=Math.min(30,30-30*(h/100)),c.appendChild(c.firstChild).style.height=a+"px",m=b,r=0),b},update:function(){l=this.end()}}}},gf.utils={_arrayDelim:"|",ensureVector:function(vec){if(vec instanceof gf.Vector)return vec;var a=vec;if("string"==typeof vec&&(a=vec.split(gf.utils._arrayDelim)),!(a instanceof Array))return"number"==typeof a?new gf.Vector(a,a):new gf.Vector;switch(a.length){case 1:return new gf.Vector(parseInt(a[0],10)||0,parseInt(a[0],10)||0);case 2:return new gf.Vector(parseInt(a[0],10)||0,parseInt(a[1],10)||0)}},noop:function(){},ajax:function(sets){sets=sets||{},sets.method=sets.method||"GET",sets.dataType=sets.dataType||"text",sets.progress=sets.progress||gf.utils.noop,sets.load=sets.load||gf.utils.noop,sets.error=sets.error||gf.utils.noop,sets.abort=sets.abort||gf.utils.noop,sets.complete=sets.complete||gf.utils.noop;var xhr=new gf.utils.AjaxRequest;return xhr.onreadystatechange=function(){if(4===xhr.readyState){var res=xhr.responseText,err=null;if("json"===sets.dataType)try{res=JSON.parse(res)}catch(e){err=e}200!==xhr.status&&(err="Non-200 status code returned: "+xhr.status),err?sets.error&&sets.error.call(xhr,err):sets.load&&sets.load.call(xhr,res)}},xhr.open(sets.method,sets.url,!0),xhr.send(),xhr},AjaxRequest:function(){var activexmodes=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new XMLHttpRequest:!1;for(var i=0;activexmodes.length>i;i++)try{return new window.ActiveXObject(activexmodes[i])}catch(e){}},setValues:function(obj,values){if(values){for(var key in values){var newVal=values[key];if(newVal!==undefined&&key in obj){var curVal=obj[key];if("number"==typeof curVal&&"string"==typeof newVal){var n;n=0===newVal.indexOf("0x")?parseInt(newVal,16):parseInt(newVal,10),isNaN(n)||(obj[key]=n)}else if(curVal instanceof gf.Vector&&newVal instanceof Array)curVal.set(parseInt(newVal[0],10)||0,parseInt(newVal[1],10)||parseInt(newVal[0],10)||0);else if(curVal instanceof gf.Vector&&"string"==typeof newVal){var a=newVal.split(gf.utils._arrayDelim,2);curVal.set(parseInt(a[0],10)||0,parseInt(a[1],10)||parseInt(a[0],10)||0)}else if(curVal instanceof gf.Vector&&"number"==typeof newVal)curVal.set(newVal,newVal);else if(curVal instanceof gf.Point&&newVal instanceof Array)curVal.x=parseInt(newVal[0],10)||0,curVal.y=parseInt(newVal[1],10)||parseInt(newVal[0],10)||0;else if(curVal instanceof gf.Point&&"string"==typeof newVal){var a2=newVal.split(gf.utils._arrayDelim,2);curVal.x=parseInt(a2[0],10)||0,curVal.y=parseInt(a2[1],10)||parseInt(a2[0],10)||0}else if(curVal instanceof gf.Point&&"number"==typeof newVal)curVal.x=newVal,curVal.y=newVal;else if(curVal instanceof Array&&"string"==typeof newVal){obj[key]=newVal.split(gf.utils._arrayDelim);for(var i=0,il=obj[key].length;il>i;++i){var val=obj[key][i];isNaN(val)||(obj[key][i]=parseInt(val,10))}}else obj[key]=newVal}}return obj}},clamp:function(n,min,max){return Math.max(min,Math.min(max,n))},getPosition:function(o){for(var l=o.offsetLeft,t=o.offsetTop;o=o.offsetParent;)l+=o.offsetLeft,t+=o.offsetTop;return{top:t,left:l}},getStyle:function(elm,prop){var style=window.getComputedStyle(elm),val=style.getPropertyValue(prop).replace(/px|em|%|pt/,"");return isNaN(val)||(val=parseInt(val,10)),val},setStyle:function(elm,prop,value){var style=window.getComputedStyle(elm);return style.setPropertyValue(prop,value)},getOffset:function(elem){var box,doc=elem&&elem.ownerDocument,docElem=doc.documentElement;
try{box=elem.getBoundingClientRect()}catch(e){}if(!box||docElem===elem||(docElem.contains?!docElem.contains(elem):0))return box?{top:box.top,left:box.left}:{top:0,left:0};var body=doc.body,win=window,clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0,scrollTop=win.pageYOffset||docElem.scrollTop||body.scrollTop,scrollLeft=win.pageXOffset||docElem.scrollLeft||body.scrollLeft,top=box.top+scrollTop-clientTop,left=box.left+scrollLeft-clientLeft;return{top:top,left:left}}},gf.Clock=function(autoStart){this.autoStart=autoStart!==undefined?autoStart:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},gf.inherits(gf.Clock,Object,{start:function(){this.startTime=window.performance!==undefined&&window.performance.now!==undefined?window.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var diff=0;if(this.autoStart&&!this.running&&this.start(),this.running){var newTime=window.performance!==undefined&&window.performance.now!==undefined?window.performance.now():Date.now();diff=.001*(newTime-this.oldTime),this.oldTime=newTime,this.elapsedTime+=diff}return diff}}),gf.ObjectPool=function(type,parent){this.type=type,this.pool=[],this.alloced=[],this.parent=parent},gf.inherits(gf.ObjectPool,Object,{create:function(){var o=this.pool.pop();return o||(o=this._construct(this.type,arguments),this.parent&&this.parent.addChild(o)),this.alloced.push(o),o},free:function(o){this.pool.push(o)},freeAll:function(){for(var i=0,il=this.alloced.length;il>i;++i)this.free(this.alloced[i]);this.alloced.length=0},_construct:function(ctor,args){function F(){return ctor.apply(this,args)}return F.prototype=ctor.prototype,new F}}),gf.Vector=function(x,y){this.x=x||0,this.y=y||0},gf.inherits(gf.Vector,Object,{set:function(x,y){return this.x=x,this.y=y,this},setX:function(x){return this.x=x,this},setY:function(y){return this.y=y,this},setComponent:function(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;default:throw Error("index is out of range: "+index)}return this},getComponent:function(index){switch(index){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+index)}},copy:function(v){return this.x=v.x,this.y=v.y,this},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},add:function(v){return this.x+=v.x,this.y+=v.y,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this},addScalar:function(s){return this.x+=s,this.y+=s,this},sub:function(v){return this.x-=v.x,this.y-=v.y,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this},multiplyScalar:function(s){return this.x*=s,this.y*=s,this},divideScalar:function(s){return 0!==s?(this.x/=s,this.y/=s):this.set(0,0),this},min:function(v){return this.x>v.x&&(this.x=v.x),this.y>v.y&&(this.y=v.y),this},max:function(v){return this.x<v.x&&(this.x=v.x),this.y<v.y&&(this.y=v.y),this},clamp:function(min,max){return this.x<min.x?this.x=min.x:this.x>max.x&&(this.x=max.x),this.y<min.y?this.y=min.y:this.y>max.y&&(this.y=max.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(v){return this.x*v.x+this.y*v.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(v){return Math.sqrt(this.distanceToSquared(v))},distanceToSquared:function(v){var dx=this.x-v.x,dy=this.y-v.y;return dx*dx+dy*dy},setLength:function(l){var oldLength=this.length();return 0!==oldLength&&l!==oldLength&&this.multiplyScalar(l/oldLength),this},lerp:function(v,alpha){return this.x+=(v.x-this.x)*alpha,this.y+=(v.y-this.y)*alpha,this},equals:function(v){return v.x===this.x&&v.y===this.y},toArray:function(){return[this.x,this.y]},clone:function(){return new gf.Vector(this.x,this.y)}}),gf.InputManager=function(game){this.game=game,this.mouse=new gf.input.Mouse(this,game),this.keyboard=new gf.input.Keyboard(this,game),this.gamepad=new gf.input.Gamepad(this,game)},gf.inherits(gf.InputManager,Object,{update:function(){this.gamepad.update()},isActionActive:function(action){return this.mouse.isActionActive(action)||this.keyboard.isActionActive(action)||this.gamepad.isActionActive(action)}}),gf.input={KEY:{BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,PLUS:61,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,NUMPAD_STAR:106,NUMPAD_PLUS:107,NUMPAD_MINUS:109,NUMPAD_DOT:110,NUMPAD_SLASH:111,F1:112,F2:113,F3:114,F4:115,MINUS:173,TILDE:192},MOUSE:{WHEEL:"mousewheel",MOVE:"mousemove",DOWN:"mousedown",UP:"mouseup",CLICK:"click",DBLCLICK:"dblclick",RCLICK:"contextmenu",CONTEXTMENU:"contextmenu"},TOUCH:{MOVE:"touchmove",START:"touchstart",END:"touchend",TAP:"tap",DBLTAP:"dbltap"},GP_BUTTON:{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_TRIGGER:6,RIGHT_TRIGGER:7,SELECT:8,START:9,LEFT_ANALOGUE_STICK:10,RIGHT_ANALOGUE_STICK:11,PAD_TOP:12,PAD_BOTTOM:13,PAD_LEFT:14,PAD_RIGHT:15},getGpButtonName:function(i){for(var k in gf.input.GP_BUTTON)if(gf.input.GP_BUTTON[k]===i)return k;return""},GP_AXIS:{LEFT_ANALOGUE_HOR:0,LEFT_ANALOGUE_VERT:1,RIGHT_ANALOGUE_HOR:2,RIGHT_ANALOGUE_VERT:3},getGpAxisName:function(i){for(var k in gf.input.GP_AXIS)if(gf.input.GP_AXIS[k]===i)return k;return""}},gf.input.Input=function(man,game){this.game=game,this.manager=man,this.binds={},this.callbacks={},this.bindCount={},this.status={}},gf.inherits(gf.input.Input,Object,{_doBind:function(code,action,cb){return this.binds[code]=action,this.status[action]=!1,this.bindCount[action]?this.bindCount[action]++:this.bindCount[action]=1,cb&&(this.callbacks[action]?this.callbacks[action].push({code:code,cb:cb}):this.callbacks[action]=[{code:code,cb:cb}]),this},_doUnbind:function(code,action){return delete this.binds[code],this.bindCount[action]--,0>=this.bindCount[action]&&(this.bindCount[action]=0,delete this.status[action],delete this.callbacks[action]),gf.controls},preventDefault:function(e){return e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault?e.preventDefault():e.returnValue=!1,!1},bind:function(code,action,cb){return this._doBind(code,action,cb)},unbind:function(code,action){return this._doUnbind(code,action)},runCallbacks:function(code,args){args=args||[],args.unshift(this.binds[code]);var cbs=this.callbacks[this.binds[code]];if(cbs)for(var i=0,il=cbs.length;il>i;++i)cbs[i].code===code&&cbs[i].cb.apply(this,args)},isActionActive:function(action){return this.status[action]}}),gf.input.Mouse=function(man,game){gf.input.Input.call(this,man,game),this.touches=[{x:0,y:0}],this.position=new gf.Point(0,0),this.offset=gf.utils.getOffset(game.renderer.view),game.renderer.view.addEventListener("touchmove",this.onMouseMove.bind(this),!1);for(var t in gf.input.Mouse.TOUCH_EVENT){if("touchmove"===gf.input.Mouse.TOUCH_EVENT[t])return;game.renderer.view.addEventListener(gf.input.Mouse.TOUCH_EVENT[t],this.onTouch.bind(this),!1)}game.renderer.view.addEventListener("mousemove",this.onMouseMove.bind(this),!1),document.addEventListener("mousewheel",this.onMouseWheel.bind(this),!1);for(var k in gf.input.Mouse.EVENT){var v=gf.input.Mouse.EVENT[k];if("mousemove"===v||"mousewheel"===v)return;game.renderer.view.addEventListener(v,this.onMouse.bind(this),!1)}},gf.inherits(gf.input.Mouse,gf.input.Input,{onMouseMove:function(e){return this.updateCoords(e),this.dispatchMouseEvent(e)?this.preventDefault(e):!0},onMouse:function(e){if(this.updateCoords(e),this.dispatchMouseEvent(e))return this.preventDefault(e);var keycode=this.binds[e.button||0];return keycode?"mousedown"===e.type||"touchstart"===e.type?this.manager.keyboard.onKeyDown(e,keycode):this.manager.keyboard.onKeyUp(e,keycode):!0},onMouseWheel:function(e){return e.target===this.game.renderer.view&&this.dispatchMouseEvent(e)?this.preventDefault(e):!0},onTouch:function(e){return this.updateCoords(e),this.onMouse(e)},updateCoords:function(e){this.touches.length=0;var off=this.offset;if(e.touches)for(var i=0,il=e.changedTouches.length;il>i;++i){var t=e.changedTouches[i];this.touches.push({x:t.clientX-off.left,y:t.clientY-off.top})}else this.touches.push({x:e.pageX-off.left,y:e.pageY-off.top,id:0});this.position.x=this.touches[0].x,this.position.y=this.touches[0].y},dispatchMouseEvent:function(e){if(this.binds[e.type]){if(this.status[this.binds[e.type]]=!0,this.callbacks[this.binds[e.type]]){for(var t=0,tl=this.touches.length;tl>t;++t)this.runCallbacks(e.type,[this.touches[t]]);return this.preventDefault(e)}return!0}}}),gf.input.Mouse.EVENT={WHEEL:"mousewheel",MOVE:"mousemove",DOWN:"mousedown",UP:"mouseup",CLICK:"click",DBLCLICK:"dblclick",RCLICK:"contextmenu",CONTEXTMENU:"contextmenu"},gf.input.Mouse.TOUCH_EVENT={MOVE:"touchmove",START:"touchstart",END:"touchend",TAP:"tap",DBLTAP:"dbltap"},gf.input.Keyboard=function(man,game){gf.input.Input.call(this,man,game),this.keydown={},document.addEventListener("keydown",this.onKeyDown.bind(this),!1),document.addEventListener("keyup",this.onKeyUp.bind(this),!1)},gf.inherits(gf.input.Keyboard,gf.input.Input,{onKeyDown:function(e,override){return this.modifyKey(e,override||e.keyCode||e.which,!0)},onKeyUp:function(e,override){return this.modifyKey(e,override||e.keyCode||e.which,!1)},modifyKey:function(e,key,val){return this.binds[key]?this.keydown[key]===val?this.preventDefault(e):(this.keydown[key]=val,this.status[this.binds[key]]=val,this.runCallbacks(key,[val]),this.preventDefault(e)):!0}}),gf.input.Gamepad=function(man,game){gf.input.Input.call(this,man,game),this.ticking=!1,this.pads=[],this.prevTimestamps=[],this.buttons=new gf.input.GamepadButtons(man,game),this.sticks=new gf.input.GamepadSticks(man,game),window.addEventListener("MozGamepadConnected",this.onGamepadConnect.bind(this),!1),window.addEventListener("MozGamepadDisconnected",this.onGamepadDisconnect.bind(this),!1),(navigator.webkitGamepads||navigator.webkitGetGamepads)&&this.startPolling()},gf.inherits(gf.input.Gamepad,gf.input.Input,{onGamepadConnect:function(event){this.pads.push(event.gamepad),this.startPolling()},onGamepadDisconnect:function(event){for(var i=0,il=this.pads.length;il>i;++i)if(this.pads[i].index===event.gamepad.index){this.pads.splice(i,1);break}0===this.pads.length&&this.stopPolling()},startPolling:function(){this.ticking||(this.ticking=!0,this.update())},stopPolling:function(){this.ticking=!1},pollGamepads:function(){var rawPads=navigator.webkitGetGamepads&&navigator.webkitGetGamepads()||navigator.webkitGamepads;if(rawPads){this.pads.length=0;for(var i=0,il=rawPads.length;il>i;++i)rawPads[i]&&this.pads.push(rawPads[i])}},pollStatus:function(){for(var i=0,il=this.pads.length;il>i;++i){var pad=this.pads[i];pad.timestamp&&pad.timestamp===gf.gamepad.prevTimestamps[i]||(this.prevTimestamps[i]=pad.timestamp,this.buttons.pollStatus(pad),this.sticks.pollStatus(pad))}},update:function(){this.ticking&&(this.pollGamepads(),this.pollStatus())},bindButton:function(code,action,cb){return this.buttons.bind(code,action,cb),this},bindStick:function(code,negative,action,cb){return this.sticks.bind(code,negative,action,cb),this},unbindButton:function(code,action){return this.buttons.unbind(code,action),this},unbindStick:function(code,negative,action){return this.sticks.unbind(code,negative,action),this}}),gf.input.GamepadButtons=function(man,game){gf.input.Input.call(this,man,game),this.threshold=.4,this.buttons={}},gf.inherits(gf.input.GamepadButtons,gf.input.Input,{pollStatus:function(pad){for(var b=0,bl=pad.buttons.length;bl>b;++b)if(this.binds[b]){var pressed=pad.buttons[b]>this.threshold;this.buttons[b]||(this.buttons[b]={pressed:!1,code:b}),this.buttons[b].val=pad.buttons[b],this.buttons[b].pressed!==pressed&&(this.buttons[b].pressed=pressed,this.status[this.binds[b]]=pressed,this.runCallbacks(b,[pressed]))}}}),gf.input.GamepadSticks=function(man,game){gf.input.Input.call(this,man,game),this.threshold=.5,this.axes={}},gf.inherits(gf.input.GamepadSticks,gf.input.Input,{bind:function(code,negative,action,cb){return negative=!!negative,this._doBind(code+negative,action,cb)},unbind:function(code,negative,action){return negative=!!negative,this._doUnbind(code+negative,action)},pollStatus:function(pad){for(var a=0,al=pad.axes.length;al>a;++a)for(var neg=["true","false"],i=0,il=neg.length;il>i;++i){var v=neg[i];if(this.binds[a+v]){var moved="true"===v?pad.axes[a]<-gf.gamepad.AXIS_THRESHOLD:pad.axes[a]>gf.gamepad.AXIS_THRESHOLD;this.axes[a+v]||(this.axes[a+v]={moved:!1,code:a,negative:"true"===v}),this.axes[a+v].val=pad.axes[a],this.axes[a+v].moved!==moved&&(this.axes[a+v].moved=moved,this.status[this.binds[a+v]]=moved,this.runCallbacks(a+v,[pad.axes[a]]))}}}}),gf.Font=function(font,settings){this.align="left",this.baseline="top",this.lineWidth=1,this.lineHeight=1,this.text="",gf.DisplayObject.call(this),gf.utils.setValues(this,settings)},gf.inherits(gf.Font,gf.DisplayObject,{setText:function(txt){this.text=txt}}),gf.TextureFont=function(font,settings){if(this.ext="",this.map={},this.spaceSize=15,gf.Font.call(this,font,settings),"string"==typeof font){if(!gf.assetCache[font])throw"Unknown texture "+font+", please load the sprite sheet first!";font=gf.assetCache[font]}this.textures=font,this.ext&&"."!==this.ext.charAt(0)&&(this.ext="."+this.ext),this.sprites=new gf.ObjectPool(PIXI.Sprite,this)},gf.inherits(gf.TextureFont,gf.Font,{_getSprite:function(ch){if(this.map[ch]&&(ch=this.map[ch]),""===ch||" "===ch)return null;if(!this.textures[ch+this.ext])throw'there is no texture for character "'+ch+'" with extension "'+this.ext+'"';var texture=this.textures[ch+this.ext],spr=this.sprites.create(texture);return spr.setTexture(texture),spr.visible=!0,spr},clone:function(){return new gf.TextureFont(this.textures,{ext:this.ext,map:this.map,text:this.text,align:this.align,baseline:this.baseline,lineWidth:this.lineWidth,lineHeight:this.lineHeight})},setText:function(txt){this.text=txt,this.sprites.freeAll();for(var c=0,cl=this.children.length;cl>c;++c)this.children[c].visible=!1;for(var strs=(""+this.text).split("\n"),h=0,x=0,y=0,i=0,il=strs.length;il>i;++i){for(var str=strs[i],s=0,sl=str.length;sl>s;++s){var ch=str.charAt(s),spr=this._getSprite(ch);null!==spr?(spr.position.x=x,spr.position.y=y,spr.texture.frame.height>h&&(h=spr.texture.frame.height),x+=spr.texture.frame.width*this.lineWidth):x+=this.spaceSize*this.lineWidth}y+=h*this.lineHeight}}}),gf.Gui=function(pos,settings){this.name="",gf.DisplayObject.call(this,settings),gf.utils.setValues(this,settings)},gf.inherits(gf.Gui,gf.DisplayObject),gf.GuiItem=function(pos,settings){this.dirty=!0,settings.texture=settings.texture||settings.image,gf.Sprite.call(this,pos,settings)},gf.inherits(gf.GuiItem,gf.Sprite,{update:function(){gf.Sprite.prototype.update.call(this)}}),gf.Hud=function(pos,settings){gf.Gui.call(this,pos,settings)},gf.inherits(gf.Hud,gf.Gui),gf.HudItem=function(pos,settings){this.value="",this.draggable=!1,this.dragging=!1,this.font=null,gf.GuiItem.call(this,pos,settings),this.initialValue=this.value,this.font instanceof gf.Font?this.addChild(this.font):(this.font=new gf.Font,this.addChild(this.font)),this.sprites=new gf.ObjectPool(PIXI.Sprite,this)},gf.inherits(gf.HudItem,gf.GuiItem,{reset:function(){return this.set(this.initialValue)},set:function(val){return this.font.setText(val),this.value=val,this},onDragStart:function(){},onDragEnd:function(){},click:function(){},mousedown:function(e){this.draggable&&(this.dragging={x:e.clientX,y:e.clientY},this.onDragStart(e))},mouseup:function(e){this.dragging=!1,this.onDragEnd(e)},mousemove:function(e){if(this.draggable&&this.dragging){var diffX=e.clientX-this.dragging.x,diffY=e.clientY-this.dragging.y,pos=gf.utils.getPosition(this.elm);this.dragging.x=e.clientX,this.dragging.y=e.clientY,this.elm.style.top=pos.top+diffY,this.elm.style.left=pos.left+diffX}}}),gf.Map=function(game,map){this.game=game,this.size=new gf.Vector(map.width,map.height),gf.DisplayObject.call(this),gf.utils.setValues(this,map)},gf.inherits(gf.Map,gf.DisplayObject,{getLayer:function(id){if("number"==typeof id)return this.layers[id]||null;if("string"==typeof id)for(var i=0,il=this.children.length;il>i;++i)if(this.children[i].name===id)return this.children[i];return null},pan:function(x,y){y=x instanceof gf.Point?x.y:y||0,x=x instanceof gf.Point?x.x:x||0,this.position.x+=x,this.position.y+=y;for(var i=0,il=this.children.length;il>i;++i){var o=this.children[i];o.visible&&o.pan&&o.pan(x,y)}}}),gf.Layer=function(layer){this.name="",this.size=new gf.Vector(layer.width||0,layer.height||0),gf.DisplayObject.call(this),gf.utils.setValues(this,layer),this.hSize=this.size.clone().divideScalar(2)},gf.inherits(gf.Layer,gf.DisplayObject,{pan:function(){}}),gf.Layer.COLLISION={NONE:"none",SOLID:"solid",CLIFF:"cliff",LADDER:"ladder",WATER:"water",DEEP_WATER:"deep_water"},gf.TiledMap=function(game,map){gf.Map.call(this,game,map),this.scale.x=parseInt(map.properties.scale,10)||1,this.scale.y=parseInt(map.properties.scale,10)||1,this.tileSize=new gf.Vector(map.tilewidth,map.tileheight),this.scaledTileSize=new gf.Vector(map.tilewidth*this.scale.x,map.tileheight*this.scale.y),this.properties=map.properties||{},this.realSize=new gf.Vector(this.size.x*this.scaledTileSize.x,this.size.y*this.scaledTileSize.y),this.orientation=map.orientation,this.tilesets=[],this.collisionTileset=null;for(var t=0,tl=map.tilesets.length;tl>t;++t){var len=this.tilesets.push(new gf.TiledTileset(map.tilesets[t]));0===this.tilesets[len-1].name.toLowerCase().indexOf("collider")&&(this.collisionTileset=this.tilesets[len-1])}this.collisionLayer=[],this.version=map.version;for(var numX=Math.ceil(this.game.renderer.view.width/this.scaledTileSize.x),numY=Math.ceil(this.game.renderer.view.height/this.scaledTileSize.y),i=0,il=map.layers.length;il>i;++i){var lyr;switch(map.layers[i].type){case"tilelayer":lyr=new gf.TiledLayer(map.layers[i]),this.addChild(lyr),lyr.renderTiles(Math.floor(this.position.x/this.tileSize.x),Math.floor(this.position.y/this.tileSize.y),numX,numY),0===lyr.name.toLowerCase().indexOf("collision")&&(this.collisionLayer=lyr,gf.debug.showMapColliders||(lyr.visible=!1));break;case"objectgroup":lyr=new gf.TiledObjectGroup(map.layers[i]),this.addChild(lyr),"player"!==lyr.name||lyr.properties.manual||lyr.spawn()}}},gf.inherits(gf.TiledMap,gf.Map,{getTileset:function(tileId){for(var i=0,il=this.tilesets.length;il>i;++i)if(tileId>=this.tilesets[i].firstgid&&this.tilesets[i].lastgid>=tileId)return this.tilesets[i]},checkCollision:function(ent,pv){if(!this.collisionLayer||!this.collisionTileset||0===pv.x&&0===pv.y)return[];if(gf.debug._showColliders&&!this.sprites&&(this.sprites=new gf.ObjectPool(PIXI.Sprite,this)),gf.debug._showColliders){this.sprites.freeAll();for(var s=0;this.sprites.pool.length>s;++s)this.sprites.pool[s].visible=!1}var step=pv.clone().normalize(),pos=ent.position,width=ent.currentAnim?ent.currentAnim.width:pos.x,height=ent.currentAnim?ent.currentAnim.height:pos.y,i=0,il=0,tile=null,res=[];if(step.x>0)for(i=pos.y,il=pos.y+height;il>i&&!(tile=this._checkPoint(new gf.Point(pos.x+width,i),step,pv,"x"));++i);else if(0>step.x)for(i=pos.y,il=pos.y+height;il>i&&!(tile=this._checkPoint(new gf.Point(pos.x,i),step,pv,"x"));++i);if(tile&&(res.push(tile),tile=null),step.y>0)for(i=pos.x,il=pos.x+width;il>i&&!(tile=this._checkPoint(new gf.Point(i,pos.y+height),step,pv,"y"));++i);else if(0>step.y)for(i=pos.x,il=pos.x+width;il>i&&!(tile=this._checkPoint(new gf.Point(i,pos.y),step,pv,"y"));++i);return tile&&(res.push(tile),tile=null),res},_showCollider:function(id,cell){var text=this.collisionTileset.getTileTexture(id);if(text){var spr=this.sprites.create(text);spr.position.x=cell.x*this.tileSize.x,spr.position.y=cell.y*this.tileSize.y,spr.alpha=.5,spr.visible=!0,spr.setTexture(text)}},_checkPoint:function(start,step,pv,ax){step=step.clone();var end=new gf.Point(start.x+pv.x,start.y+pv.y),cell=new gf.Point(Math.floor(start.x/this.tileSize.x),Math.floor(start.y/this.tileSize.y)),endCell=new gf.Point(Math.floor(end.x/this.tileSize.x),Math.floor(end.y/this.tileSize.y)),tDelta=new gf.Vector(this.tileSize.x/Math.abs(step.x),this.tileSize.y/Math.abs(step.y)),tMax=new gf.Point,id=0,tile=null;if(tMax.x=end.x>start.x?0===step.x?0:((cell.x+1)*this.tileSize.x-start.x)/step.x:0===step.x?0:(cell.x*this.tileSize.x-start.x)/step.x,tMax.y=end.y>start.y?0===step.y?0:((cell.y+1)*this.tileSize.y-start.y)/step.y:0===step.y?0:(cell.y*this.tileSize.y-start.y)/step.y,step.x=0>step.x?Math.floor(step.x):Math.ceil(step.x),step.y=0>step.y?Math.floor(step.y):Math.ceil(step.y),id=this.collisionLayer.tiles[cell.x+cell.y*this.collisionLayer.size.x],tile=this.collisionTileset.getTileProperties(id),tile&&tile.isCollidable)return gf.debug._showColliders&&this._showCollider(id,cell),{axis:ax,tile:tile};for(;cell.x!==endCell.x||cell.y!==endCell.y;)if(tMax.x<tMax.y?(tMax.x+=tDelta.x,cell.x+=step.x,ax="x"):(tMax.y+=tDelta.y,cell.y+=step.y,ax="y"),id=this.collisionLayer.tiles[cell.x+cell.y*this.collisionLayer.size.x],tile=this.collisionTileset.getTileProperties(id),tile&&tile.isCollidable)return gf.debug._showColliders&&this._showCollider(id,cell),{axis:ax,tile:tile}},resize:function(){for(var numX=Math.ceil(this.game.renderer.view.width/this.scaledTileSize.x),numY=Math.ceil(this.game.renderer.view.height/this.scaledTileSize.y),i=0,il=this.children.length;il>i;++i){var o=this.children[i];o instanceof gf.TiledLayer&&o.visible&&o.renderTiles(Math.floor(this.position.x/this.scaledTileSize.x),Math.floor(this.position.y/this.scaledTileSize.y),numX,numY)}},_checkHalfBlock:function(half,x,y){var tx=Math.floor(x/this.scaledTileSize.x)*this.scaledTileSize.x,ty=Math.floor(y/this.scaledTileSize.y)*this.scaledTileSize.y,midX=tx+this.scaledTileSize.x/2,endX=tx+this.scaledTileSize.x,midY=ty-this.scaledTileSize.y/2,endY=ty-this.scaledTileSize.y;switch(half){case gf.types.HALF.LEFT:return x>tx&&midX>x;case gf.types.HALF.RIGHT:return x>midX&&endX>x;case gf.types.HALF.TOP:return y>midY&&ty>y;case gf.types.HALF.BOTTOM:return y>endY&&midY>y}return!1}}),gf.TiledLayer=function(layer){gf.Layer.call(this,layer),this.tiles=gf.support.typedArrays?new Uint32Array(layer.data):layer.data,this.sprites={},this.position.x=layer.x,this.position.y=layer.y,this.alpha=layer.opacity,this._tileBufferSize=2,this._panDelta=new gf.Vector(0,0),this._rendered=new PIXI.Rectangle(0,0,0,0)},gf.inherits(gf.TiledLayer,gf.Layer,{renderTiles:function(startX,startY,numX,numY){startX-=this._tileBufferSize,numX+=2*this._tileBufferSize,startY-=this._tileBufferSize,numY+=2*this._tileBufferSize;for(var x=startX;numX>x;++x)for(var y=startY;numY>y;++y)this.moveTileSprite(x,y,x,y);this._rendered.x=startX,this._rendered.y=startY,this._rendered.width=numX,this._rendered.height=numY,this._rendered.left=this._rendered.x,this._rendered.right=this._rendered.x+this._rendered.width,this._rendered.top=this._rendered.y,this._rendered.bottom=this._rendered.y+this._rendered.height},getTileSprite:function(tileX,tileY){if(this.sprites[tileX]&&this.sprites[tileX][tileY])return this.sprites[tileX][tileY];this.sprites[tileX]||(this.sprites[tileX]={});var id=tileX+tileY*this.size.x,tile=this.tiles[id],set=this.parent.getTileset(tile);return set&&(this.sprites[tileX][tileY]=new PIXI.Sprite(set.getTileTexture(tile)),this.addChild(this.sprites[tileX][tileY])),this.sprites[tileX][tileY]},moveTileSprite:function(fromTileX,fromTileY,toTileX,toTileY){var spr=this.getTileSprite(fromTileX,fromTileY);if(spr){var id=toTileX+toTileY*this.size.x,tile=this.tiles[id],set=this.parent.getTileset(tile);return set&&spr.setTexture(set.getTileTexture(tile)),spr.position.x=toTileX*this.parent.tileSize.x,spr.position.y=toTileY*this.parent.tileSize.y,this.sprites[toTileX]||(this.sprites[toTileX]={}),this.sprites[toTileX][toTileY]=spr,this.sprites[fromTileX][fromTileY]=null,spr}},getTileIndex:function(x,y){return x=x instanceof gf.Vector?x.x:x,y=x instanceof gf.Vector?x.y:y,x=Math.floor(x/this.parent.tileSize.x),y=Math.floor(y/this.parent.tileSize.y),x+y*this.size.x},getTileId:function(x,y){return this.tiles[this.getTileIndex(x,y)]},pan:function(dx,dy){for(this._panDelta.x+=dx,this._panDelta.y+=dy;this._panDelta.x>=this.parent.scaledTileSize.x;)this._renderLeft(),this._panDelta.x-=this.parent.scaledTileSize.x;for(;this._panDelta.x<=-this.parent.scaledTileSize.x;)this._renderRight(),this._panDelta.x+=this.parent.scaledTileSize.x;for(;this._panDelta.y>=this.parent.scaledTileSize.y;)this._renderUp(),this._panDelta.y-=this.parent.scaledTileSize.y;for(;this._panDelta.y<=-this.parent.scaledTileSize.y;)this._renderDown(),this._panDelta.y+=this.parent.scaledTileSize.y},_renderLeft:function(){for(var i=0;this._rendered.height>i;++i)this.moveTileSprite(this._rendered.right,this._rendered.top+i,this._rendered.left,this._rendered.top+i);this._rendered.x--,this._rendered.left--,this._rendered.right--},_renderRight:function(){for(var i=0;this._rendered.height>i;++i)this.moveTileSprite(this._rendered.left,this._rendered.top+i,this._rendered.right,this._rendered.top+i);this._rendered.x++,this._rendered.left++,this._rendered.right++},_renderUp:function(){for(var i=0;this._rendered.width>i;++i)this.moveTileSprite(this._rendered.left+i,this._rendered.bottom,this._rendered.left+i,this._rendered.top);this._rendered.y--,this._rendered.top--,this._rendered.bottom--},_renderDown:function(){for(var i=0;this._rendered.width>i;++i)this.moveTileSprite(this._rendered.left+i,this._rendered.top,this._rendered.left+i,this._rendered.bottom);this._rendered.y++,this._rendered.top++,this._rendered.bottom++}}),gf.TiledTileset=function(settings){if(!gf.assetCache[settings.name+"_texture"]){var loader=new gf.AssetLoader;loader.loadTexture(settings.name+"_texture",settings.image)}gf.Texture.call(this,gf.assetCache[settings.name+"_texture"].baseTexture),this.size=new gf.Vector(settings.imagewidth,settings.imageheight),this.tileSize=new gf.Vector(settings.tilewidth,settings.tileheight),this.name=settings.name,this.margin=settings.margin,this.spacing=settings.spacing,this.numTiles=new gf.Vector(~~((this.baseTexture.source.width-this.margin)/(this.tileSize.x+this.spacing)),~~((this.baseTexture.source.height-this.margin)/(this.tileSize.y+this.spacing))),this.firstgid=settings.firstgid,this.lastgid=this.firstgid+(this.numTiles.x*this.numTiles.y-1||0),this.properties=settings.properties||{},this.tileproperties=settings.tileproperties||{};for(var i in this.tileproperties){var v=this.tileproperties[i];v.normal&&(v.normal=gf.utils.ensureVector(v.normal)),"true"===v.isCollidable&&(v.isCollidable=!0),"true"===v.isBreakable&&(v.isBreakable=!0)}this.textures=[];for(var t=0,tl=this.lastgid-this.firstgid;tl>t;++t){var y=~~(t/this.numTiles.x),x=t-y*this.numTiles.x;this.textures.push(new gf.Texture(this.baseTexture,new PIXI.Rectangle(x*this.tileSize.x,y*this.tileSize.y,this.tileSize.x,this.tileSize.y)))}},gf.inherits(gf.TiledTileset,gf.Texture,{getTileProperties:function(tileId){return tileId===undefined?null:(tileId-=this.firstgid,0>tileId?null:this.tileproperties[tileId]?this.tileproperties[tileId]:this.tileproperties[tileId]={isCollidable:!1,isBreakable:!1,type:gf.Layer.COLLISION.NONE})},getTileTexture:function(tileId){return tileId===undefined?null:(tileId-=this.firstgid,0>tileId?null:this.textures[tileId])}}),gf.TiledObjectGroup=function(group){gf.Layer.call(this,group),this.properties=group.properties||{},this.objects=group.objects,this.position.x=group.x,this.position.y=group.y,this.alpha=group.opacity},gf.inherits(gf.TiledObjectGroup,gf.Layer,{spawn:function(){for(var i=0,il=this.objects.length;il>i;++i){var o=this.objects[i],props=o.properties||{};props.name=o.name,props.type=o.type,props.size=[o.width,o.height],props.zIndex=this.zIndex,props.opacity=this.opacity,props.visible=this.visible,props.position=[o.x,o.y],this.addChild(gf.entityPool.create(this.parent.game,props.name,props)),this.parent.game.players.push(this.children[i])}return this},despawn:function(){for(var i=this.children.length;i>-1;--i)this.removeChild(this.children[i]);return this}}),gf.plugin={Base:function(){},patch:function(obj,name,fn){if(obj.prototype!==undefined&&(obj=obj.prototype),"function"!=typeof obj[name]||"function"!=typeof fn)throw name+" is not a function in the passed object.";var _super=obj[name];obj[name]=function(name,fn){return function(){var tmp=this._super;this._super=_super;var ret=fn.apply(this,arguments);return this._super=tmp,ret}}(name,fn)},register:function(plugin,name){if(gf.plugin[name])throw"plugin "+name+" already registered!";if(plugin.prototype.gfVersion===undefined)throw"GradeFruitJS: Plugin gfVersion not defined for "+name;if(gf.checkVersion(plugin.prototype.gfVersion)>0)throw"GradeFruitJS: Plugin gfVersion mismatch, expected: "+plugin.prototype.gfVersion+", got: "+gf.version;gf.plugin[name]=plugin}}})(window);